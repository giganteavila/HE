### 2.1 Intelligence Gathering

«

Bs coruacin oe ronmecin ocaorrnanas

2.1. Intelligence gathering

En la Unidad 1 se estudiaron las diferentes fases de un test de intrusion, entre
ellas la fase de recoleccién o recopilación de información que se considera una
de las mas importantes, ya que permite conocer de manera detallada el objeti-
vo y asi disefiar una estrategia de ataque efectiva,

La información publicada en la red no para de crecer. A diario, miles de millones
de personas se conectan a internet y publican datos de sus vidas, de sus viajes,
comparten fotos y videos, escriben articulos, actualizan sus paginas web y las
‘empresas suben documentos a sus servidores. De toda la informacion disponi-
ble, gcudl es la que puede interesar mas?

En primer lugar es interesante averiguar Ia información comercial y legal de!
‘objetivo como detalles de sus empleados y los cargos que ocupan, sus di-
recciones de correo, las relaciones de la empresa con otras compafiias, su-
ministradores y clientes, conocer qué tipos de proyectos desarrolla, marcas
registradas y patentes que posee y otra información similar.

En segundo lugar es de interés conocer Ia información tecnolégica de la em-
presa como el tipo de servicio web 0 gestor de contenides que emplea, si hace
uso de servicios en la nube y de qué tipo son, metadatos de documentos para
averiguar el tipo de software de edicién y gestion y sus versiones, los dominios
registrados, si estan en uso o abandonados, el rango de direcciones IP de los.
diferentes servicios, documentacién interna publicada por error y que esta ac
cesible a través del navegador, infraestructura de la red interna, el tipo de pro-
tocolos que se emplean, etcétera,

La información recopilada puede ser enorme y poco util, por lo que debe ser
tratada y procesada para generar inteligencia, La inteligencia es un producto
‘obtenido tras aplicar el ciclo de inteligencia a la informaci6n obtenida. La in~
teligencia tiene un valor mucho més elevado que la información, es més util y
precisa, por lo que el test de intrusion tendré mayores probabilidades de éxito. A
‘este proceso de obtener inteligencia se le conoce como intelligence gathering.

La elberinteligencia consiste en aplicar Ia inteligencia al ciberespacio de modo
que se puedan detectar las amenazas y neutralizarlas antes de que ocurran,

La Figura 2.1 representa una categorizacién en funcién de la calidad del saber
que permite realizar un Juicio 0 una decisién lo més acertada posible. los da
tos son material no organizado ni analizado, por lo que deben ser procesados.
Por ejemplo, una fecha, una lista de afios, un nombre, un cargo. La información
serlan los datos que han sido organizados y procesados, y el conecimiento una
combinacién de información, experiencia e intuicién. Ademés, se debe tener en
‘cuenta que disponer de mayor cantidad de datos o información puede entor-
pecer la mejora de su calidad, no llegando a lograr la inteligencia adecuada.

2. RECOPILACION DE INFORMACION 0 FoOTPRINTING &

Figura 21. Pirémide de información.
(Fuente: tps: /omwutesearchgatenet/igure/Figura-3-Pramide-
Informacional-Fuente-Ponjuan-bante-Cloria- 1998. fg2_27297314).

En esta unidad se presentan numerosas herramientas que automatizan la tarea
de recopilar información, pero es importante tener en cuenta que ninguna herra-
mienta es capaz de sustituir al analista, Por tanto, el uso exclusive de herramien-
tas autométicas conlleva el riesgo de pasar por alto información util o relevante
que un buen analista seria capaz de identificar.

El numero de fuentes de las que se puede obtener información para generar
inteligencia es enorme; por ello, hay disciplinas especificas para cada una de
ellas, Segin la Oficina del Director de Inteligencia Nacional de los Estados Uni
dos, se distinguen seis disciplinas diferentes!

# OSINT (Open Source intelligence): inteligencia en fuentes abiertas.
HUMINT (Human intelligence): inteligencia de fuentes humanas

+ SIGINT (signal inteligence):inteligencia de senales.

+ GEOINT (Geospacial inteligence):inteligencia geoespacial

* IMINT (imagery inteligence):inteligencia de imagenes.

+ MASINT (Measurement And signature intelligence): inteligencia basada en
medidas fisicas.

Acontinuacién se explican aquellas que se consideran mas relevantes para un
hacker ético: OSINT, HUMINT y SIGINT.

* gqué es inteligencia? Oficina del Director de intaligencia Nacional (en inglés).
inttps:wuwzcnigov/indexphp|what-we-do/what-is-inteligence

#### 2.1.1 Inteligencia en fuentes abiertas (OSINT)

B 2. RECOPILACION DE INFORMACION 0 FoOTPaIRTING

“

2.1.1. Inteligencia en fuentes abiertas (OSINT)

Los buscadores de internet, como Google, DuckDuckGo © Yahoo, permiten rea-

lizar busquedas de información en la red en un tiempo récord, Ademds, existen

otros buscadores especiatizados en la busqueda de imagenes, buscadores tec-

nolégicos, ete, que permiten obtener una información mas precisa de nuestro

objetivo (Apartado 2.4.2)

Esta bisqueda de información en la que se indaga en fuentes piblicas se co-

noce como inteligencia en fuentes abiertas u Open Source intelligence (OSINT),

Es importante destacar que fuente abierta no significa necesariamente que la

fuente sea gratuita o digital. Dependiendo de la investigacién que se esté lle-

vando a cabo, puede ser relevante obtener información del registro mercantil,

del catastro, de archives documentales provinciales o estatales, etc, que siendo

fuentes pablicas su acceso puede tener algtin coste.

txisten multitud de fuentes abiertas de las cuales se puede obtener información

relevante, por ejemplo:

4 Medios de comunicacién: prensa ontine y escrita, television, radio.

‘+ Fuentes gubernamentales: boletin oficial del estado, boletines oficiales auto-
némicos y provinclales, registros gubernamentales.

¢ Conferencias, simposios, articulos de investigacion, biblioteca online, etcétera,

2.1.2. Inteligencia de fuentes humanas (HUMINT)

Se trata de un tipo de inteligencia que se elabora a partir de informacion reco-
gida 0 suministrada directamente por personas; comanmente se conoce como
espionaje. La información suministrada por fuentes humanas es muy util por-
que puede proporcionar información imposible de adquitir por otros medios.

La obtencién de información por medio de fuentes humanas tiene dos fases que
implican, primero, la captacién e infitracién de la fuente (lo que muchas veces
conlleva una cantidad de recursos importantes), y, « continuacién, la evaluacién
de la información adquirida de la fuente por parte de los oficiales de inteligencia
responsables y de los analistas teniendo en cuenta la propia naturaleza de la
persona. Por ejemplo, acudir a la cafeteria donde habitualmente desayunan los
trabajadores de una empresa y escuchar sus conversaciones puede ser una Via
de obtencién de información muy atl, pero también costosa,

2.1.3. Inteligencia de sefiales (SIGINT)

Se trata de un tipo especifico de inteligencia que se elabora a partir de la ob-
tenci6n y el procesamiento de datos provenientes de la deteccién, intercepta-
cién y descifrado de sefiales y transmisiones de cualquier tipo.

2. RECOPILACION DE WnFORMACION O FoOTPRIOTING

Sise desea conocer més acerca del andlisis de senales, se recomienda visualizer
la charla Matrioshka SIGINT. Andlisis de seriales ocultas? que David Marugén rea~
li26 en la Conferencia intelCon 2020. David Marugén (https;//www.davidmarugan.
es/) es un investigador especializado en el andlisis de seniales de radio y miembro
de Mundo Hacker Team, entre otros muchos aspectos destacables de su curriculo.

2.2. Redes anénimas

Como se sabe, la navegacién a través de Internet deja rastro. Las redes anéni-
mas surgen con el objetivo de conseguir privacidad absoluta y una navegacién
plenamente anónima. Hay diversas redes anénimas; la mas conocida es TOR
(the Onion Router), pero hay otras menos conocidas como 2° (The invisible in-
ternet Project) o FreeNeT>

Este libro se centra en el uso y funcionamiento de TOR con objeto de anonimizar
nuestro entorno de trabajo y buscar información durante la fase de reconoci-
miento sin dejar rastro,

Sise desea conocer més detalles acerca del funcionamiento de las distintas re~
des anénimas, se recomienda consultar el libro Deep Web: TOR, FreeNet & 12°.
Privacidad y Anonimato, de Daniel Echeverri (alias Adastra), publicado por la
editorial OxWord,

2.2.1. Lo red oculta

En los Gltimos afies se han acunado términos como deep web o dark web que
‘en muchas ocasiones se utilizan de forma indistinta cuando representan con
ceptos diferentes. A menudo se emplea Ia imagen de un iceberg para represen
tar los distintos tipos de información que se pueden encontrar en Internet, como
el que se muestra en la Figura 2.2.

Los diferentes niveles representados en el iceberg se relacionan con el modo en
que Ia información esta disponible.

¢ Surface web o web superficial. Representa Ia Informacién accesible publi-
camente y que esté indexada por los buscadores. Al ser la parte visible del
iceberg se quiere hacer notar que esta es solo la parte més pequefia con res-
pecto a todo lo que hay oculto debajo de la superficie.

2 Matrioshka SIGINT. Andlsis de senales ocutas. tps! youtube/Udvor2v0vN

2 cémo entrar en la Deep Web: guia 2023 para entrar en TOR, ZeroNet,Freenete IP.
utp uwerxataka com/basics/como-entrar-deep-web-guia-2020-para-entior-tor~
reronet-treenet-e-12p,

&

B ‘2 RECOPILACION DE INFORMACION O FOOTPRIATING

+ Deep web. Representa aquella información que siendo accesible no esté in
  dexada por los buscadores, bien porque se trata de información generada
  dinamicamente, bien porque esta detras de bloqueadores (captchas, formu-
  larios de autenticacién, eteétera).

¢ Dark web. Representa información que no esté indexada por buscadores de
Internet y que requiere de clientes especificos para acceder a ella, por lo que
su acceso esta restringido.

Deep Web

Figura 22. Iceberg representando los conceptos de surface web, deep web y dark web.
(Fuente: https://nwwindependent co.ug/technology-how-dark-Is-dark-web/).

‘category ‘shot total ‘of active
Volence 03 08
‘ams os as
ime Sociat a2 24
backing as 33
eos 23 “2
ies nornesraphy, 2.3 as
‘earemism 27 sa
te omnee ae 7
me nance 63 2
ie ones on 355
onsiictsunknown 23.6 2
Inaetive a

lative 223

Figura 23. Porcentojes de servilos oftecidos en la red TOR clasificados en diferentes categorias.
[Fuente: https://en wikipedia org /witi/Tor_(network)]

0

La dark web se relaciona comtinmente con la ciberdelincuencia, pero no todo
cena dark web es contenido lito. Como se puede ver en la Figura 23, se estima
que el 43,2 % de los sitios activos en la red TOR son de contenido lito o desco-
nocido, mientras que el 86,8 % seria contenido ilcito (temas financieros, drogas,
porogratia, armas o ciberdelincuencia).

2.2.2. VPM vs redes anénimas

Una VPN (Virtual Private Network) permite ocultar la IP origen de la comunicacién
al destinatario ofreciendo anonimato y privacidad, por lo que a priori ofrece las
mismas caracteristicas que las redes anénimas. sin embargo, os servidores VPN
pertenecen a corporaciones o entidades privadas principalmente, por lo que se
debe confiar ciegamente en que no faeiltarén los datos de nuestras conexiones.
Estas suelen anunciarse en estos términos; por ejemplo, uno de los servicios més
famosos, ProtonVPN, de Ia empresa suiza Proton, afirma lo siguiente en su pagi-
na webs

Keep your browsing history private. As a Swiss VPN provider, we do net log
ser activity or share data with third parties. Our anonymous VPN service
enables internet without surveillancer.

Sin embargo, en 2021 se publicé la noticia de que un activista francés habia sido
detenido y su IP se habia almacenado a través de los servicios de ProtonMall, el
servicio de correo electrénico de la empresa Por tanto, la afirmacién de com-
pleto anonimato no es cierta, ya que no se cumple en caso de que haya un re-
querimiento judicial a a empresa. En cambio, las redes anénimas son redes
descentralizadas (P2P), por lo que el control de la red y de los nodos de esta es
mucho més complejo (aunque también se intenta)

El uso de redes anénimas puede tener algunos inconvenientes. A menudo son
bloqueadas por algunos proveedores al identificar que la direcci6n IP desde la
que se establece a conexién pertenece a este tipo de redes. Esto también puede
‘currir para conexiones a través de servidores VPN, pero es menos frecuente.

Asimismo, la conexi6n a través de una VPN 0 una red anónima es bastante mas
lenta que una conexién normal, por lo que puede notarse cierta latencia, que
puede ser atin mayor en el caso de las redes anénimas al utilizar estas mas ca~
pas de cifrado y nodos intermedios en las comunicaciones.

4 ProtonMail lmacena en sus logs la IP de un activsta francés @ raquerimiento de las autoridades
‘suizas (on inglés) tps; /techerunch com/2021/08/06/protonmailogged-ip-address-of-trench~
‘ctivist-after-order-by-swise-authorties)

0

‘2 RECOPILACION DE INFORMACION O FOOTPRIATING &


®

GBs coruacin oe nronmecin overruns

2.2.3. Origen y funcionamiento de Ia red Tor

Los origenes de Tor se remontan al proyecto Onion Routing (enrutado de cebo-
lla) que levaba a cabo el Laboratorio de investigacién Naval de E€. UU. durante
los anos 80. EI nombre representa el modo en el que funcionan las comunicacio-
nes en Tor, donde se utilizan diferentes capas de cifrado, cada una envolviendo
‘ala anterior, como las capas de una cebolla. En el ao 2004 se publicé el cédigo
fuente del proyecto con licencia abierta y la Electronic Frontier Foundation (EFF)
‘comenzé a financiarlo. Dos atios més tarde, en 2006, se fundé Tor Project® como.
tuna organizacién sin animo de lucro. Hoy en dia, la red Tor dispone de miles de
nodes, llamados relays, operados por voluntarios.

Tor es una red de nodos (relays) descentralizada en la que, para llevar a cabo
una comunicacién entre origen y destino, es necesario establecer una ruta a
través de tres relays aleatorios; a esto se conoce come circuito de nodos en
Tor. El Gltimo nodo, llamado exit relay © nodo de salida, es el que envia el tra~
fico al destino a través de Internet. De este modo, la privacidad y el anenima-
to estén garantizados, ya que ningén intermediario podré fisgar en los datos
(estan ciftados) y no seré posible conocer el origen de las comunicaciones al
crearse un circuito aleatorio a través de diferentes relays. Sin embargo, como
se verG a continuacién, existen ciertas condiciones en las que este anonimato
puede verse comprometido, por lo que esta «garantia» de anonimato no es del
100%

La Figura 24 se ha obtenido de la web del proyecto Tor y permite analizar emo
de seguras son las comunicaciones. En la web se pueden activar y desactivar los
botones de trafico HTTPS y Tor que se encuentran en la parte superior izquierda.
Los datos de la comunicacién se representan mediante un bocadillo naranja en
ccuyo interior se distinguen varios elementos: la URL del dominio al que se quiere
‘acceder, datos de usuario y contrasena, otros datos y a localizacién propia (di-
reccién IP)

Asimismo, en el grdfico aparecen los diferentes actores que pueden husmear
el trdfico en cualquier punto de la comunicacién. Puede haber control por parte
de nuestro ISP (nodo de entrada) o en el ISP de salida, asi como en el dominio al
que se esté accediendo. También es posible el espionaje de las comunicaciones
por parte de organizaciones gubernamentales o de un individuo malicioso en
‘cualquier punto de la ruta.

En caso de no usar conexiones seguras con tréfico HTTPS todos nuestros datos
estardn al aleance de cualquiera, pero si se activa el trafico HTTPS, lo que significa

‘Historia del proyecto Tor (en inglés). tips! |www.torprojectorg/about/history!

2. RECOPILACION DE INFORMACION 0 FoOTPRINTING &

que site.com utiliza este tipo de conexién, nuestros datos dejan de ser accesibles,
pero contindan siéndolo nuestra IP y el dominio al que nos estamos conectando.
‘Ademas, los datos si serdn accesibles si el dominio final esta intervenido.

Figura 2.4, Esquema donde se representa la inseguridadd de las comunicaciones
cuando no se emplea cirado, asi come is diferentes actores que pueden husmear el téfico.
(Fuente: htps://tb-manualtorproject org/secure-connections/)

La Figura 2.5 representa una conexién a un servicio de Internet usando Tor. En
‘este caso se puede observar cémo los posibles actores que estuvieran fisgo-
neando hasta el primer relay de Tor disponen de nuestra localizacién pero des-
conocen la URL a la que queremos acceder; en cambio, a partir del exit relay
se conoce Ia URL destino pero no es posible determinar el origen de la conexién,
por lo que, en teoria, resulta imposible relacionar ambos extremos.

2


&

2. AECOPILACION DE INFORMACION O FOOTPRIOTING

Figura 25. esquema donde se representa la seguridad de las comunicaciones cuando se utiliza Tor.
(Fuente: htts://to-manualtorprojectorg/secure-connections/)

Hay numerosas investigaciones dedicadas a explorar las posibles vias de ata-
que al anonimato de la red Tor. La imposibilidad de relacionar e! trfico del nodo
de salida de Tor con la localizacién original no es tal que ast, ya que existen algu-
nas formas de correlacionar ambas conexiones, por ejemplo a través del andlisis
de los movimientos del ratén (mouse fingerprinting) o determinando la hue-
lla en el circuito de relays de Tor utilizado en la conexién (eireuit fingerprinting
attack); son algunas de las debilidades descubiertas Especialmente relevante
fue la caida de Silk Road, e! mayor sitio online de venta de drogas y servicios
ilieitos en Tor. Su creador, Ross Ulbricht, fue detenido por el FBl en 2013 y se han
creado varias peliculas y documentales contando su historia,

© Debilidades dela red Tor (en inglés). https: fen wikipedia org/ wiki Tor_(network)#Weaknesses

"

2. RECOPILACION DE INFORMACION 0 FoOTPRINTING &

‘Cualquier persona puede crear un servicio oculto, conocido como hidden service,
y ponerlo accesible en Tor. Los servicios ocultos son direcciones con dominio
onion, pero estas direcciones no se resuelven mediante el protocolo DNS.

Los nombres de dominio en Tor consisten en una cadena de 16 caracteres en fa
versién 2 (ya obsoleta) 0 86 caracteres en la version 2, Esta direccin se gene~
ra. partir de la clave pablica del servicio oculto, que da como resultado una lis-
ta aleatoria eilegible de caracteres. Es posible generar dominios que tengan una
cadena concreta, por ejemplo que comiencen por el nombre de la organizacién;
para ello, es necesario generar claves de forma aleatoria hasta obtener la ca~
dena deseada, lo que resulta computacionalmente muy costoso. Un ejemplo de
esto es el dominio del buscador DuckDuckGo en Tor:

duckduckgogg42xjoc72x3sjasowoarfbgemvfimafttstwagswzczad.onion

2.2.4. Uso de Tor en las comunicaciones

‘or se puede utilizar de dos formas: para navegar por internet obteniendo la priva~
cidad que ofrece esta red, que es lo que se conoce como navegacién outproxy; o
para acceder a los servicios ocultos (hidden services) disponibles solo en la red
Tor (navegacién inproxy).

Se dispone de diversas herramientas para navegar a través de Tor. La principal
es Tor Browser, que se puede descargar e instalar a través de la web del proyec-
to Tor. El navegador dispone de diferentes niveles de seguridad (Standard, Safer
y Safest); el recomendado para navegar por la dark web es safest como se ob-
serva en |a Figura 26,

Figura 26. Niveles de seguridad del navegador Tor
(Fuente: https//to-manualtorprojectorg/secunity-settings/)

8

# OCR Extracted Content from Images 90, 92, 94, 96, 98

B 2. RECOPILACION DE INFORMACION 0 FoOTPaIRTING

8

-Ademés, el proyecto Get Tor ofrece diferentes vias de acceso para aquellas per~
sonas que tratan de conectarse desde paises con censura.?

Para que las conexiones utilicen Tor desde el dispositive Android propio existe la
‘aplicacién Orbot. Esta aplicacién crea un proxy a través del cual circularé todo
el trdfico de las apps de! mévil Para navegar a través de la web se dispone de la
aplicacién Orfox, que requiere tener instalado Orbet en el mévil® Ambas aplica~
ciones estén disponibles para descargar desde Google Play.

Para hacer esto mismo en el equipo de sobremesa o portatil hay que crear un
proxy SOCKS 5. En los sistemas Linux se dispone de las herramientas en linea de
‘comandos Tor Service y Proxychains. En el laboratorio del Apartado 2.5.1 se ex-
plica cémo configurar y utilizar estas herramientas.

Por dltimo, si se desea que todo el tréfico de los dispositivos de la red doméstica
circule a través de Tor y se quiere hacer de forma transparente, hay que realizar
toda la configuracion en el router de salida de Internet. Una de las formas de ha-
cerlo es usar una Raspberry Pi?

2.3. Reconocimiento de infraestructura mediante DNS

El reconocimiento DNS" se puede realizar en su mayor parte de forma pasiva,
puesto que los datos se obtienen de registros pUblicos. El objetivo seré determinar
direcciones DNS, nombres de dominio y subdominios, servidores de correo, ser~
vidores web, servidores de nombres, rangos de direcciones IP y configuraciones
‘erréneas en algunos de estos para obtener informaci6n adicional que no deberia
ser pilica

Una vez que se obtiene toda esa información se continda explorando cada uno
de los recursos (los diferentes dominios y subdominios descubiertos) para seguir
recopilando més información de cada uno de ellos. Para hacer esto, se emplean
las técnicas que se describen en el Apartado 24

Al concluir esta fase, la información obtenida se usa en la fase siguiente de es-
ccaneo y enumeracién (véase la Unidad 3),

7 nlormactén para obtener Tor evitando la censura (en inglés)
itp feupporttorpojectorg/eensorship/

* paginas con informacion de as apfeaciones Orboty oxox (en inglés).
  Great https! /quardonprojectinte/oppeforgtorprojectandrot
  Orfox tips guardonprojectinto/oppeinta.guaraianprojectotox!

* Guia para configurar un proxy Tor en una Raspberry Pi (en inglés).
  itp learn adatrt.corn/orvon-poverview °

> Enos recursos para el profesorad en la web de Paraninfo se encuentra un dacumento
> {de introduceion al funcionamiento dal protocolo DNS.

2. RECOPILACION DE INFORMACION 0 FoOTPRINTING &

2.3.1. Informacion whois

Segtin datos de Verisign, a finales del tercer trimestre de 2021 existian 2644 mi-
llones de nombres de dominio. El registrante (registrant) de un dominio debe
proporcionar información bésica para poder hacerse con él, El protocolo whois
(RFC 3912) permite consultar y almacenar esta información: nombre, correo
electrénico, direccién, teléfono, datos de contacto administrativo y técnico, re-
gistrador, fecha de creación y expiracién, y opcionalmente los servidores DNS
donde esté alojado. Hoy en aia, gran parte de los datos personales del registran-
te no se muestran como medida de proteccién de privacidad

La informacion whois referente a un dominio no est disponible en una base de
datos centralizada, sino que esté distribuida y es administrada por entidades in-
dependientes: los registradores (registrars) y los registros (registries). Estos re
gistradores estén acreditados por la ICANN (Internet Corporation for Assigned
Names and Numbers) para gestionar el registro de nombres de dominio y aso-
clarlos a direcciones IP.

Algunas de las normas estipuladas por Ia ICANN para los registradores son:
‘¢ Requerira los clientes que acepten los términos y condiciones.
¢ Informar alos clientes cuando su dominio esté a punto de caducar.

Publicar la información en whois y asegurarse de que esté actualizada.

Registrant Registry operators
aQ— — S) —— &
= rane

Figura 27.Relocién env os actores que intervonen on lragistre
ie dominiogy al mentenmionto de intrmacten whole,
(ruente: hips! Jupintensity.com/Dest-whols-lookup-stes/)

“sta de registradores acrecitados por ICANN (on inglés). ttp://mmulintericinet/regis html



B 2. RECOPILACION DE INFORMACION 0 FoOTPaIRTING

Los operadores de registros (registry operators) son organizaciones (bajo con-
trato de la ICANN) que gestionan dominios de primer nivel (TLD), en conereto,
QTLD. Se encargan de mantener la base de datos maestra de todos los nombres
de dominio registrados en cada TLD y generar el archivo de zona que permite
a las computadoras encaminar el tréfico de internet hacia y desde los TLD en
‘cualquier lugar de! mundo,

La información almacenada en Whois se puede consultar mediante herramien-
tas web o herramientas en linea de comands. Aigunas herramientas web co-
nocidas son:

* Whois.net:https://whois:net/
* whois: https://whoiis/

¢ lookup.icann.org: http://lookupicann.org/

+  goddady: https:// godaday.com/whois

En la linea de comandos esta disponible el comando whois. El siguiente ejemplo
muestra la información que se obtiene para el dominio iberdrola.com (la salida
se muestra abreviada).

F whois Sherarola.com
agistey Domain 1D: 2114955 newsn com-vasH
agistrar WHOIS Server: vhoia.azcto.com
hagistsar URL: heepi//w.ascio.com
‘Updated Date: 2021-10-06207:015332
agistey Expiry Date: 2022-10-0520¢:00:002
aagiztrars Jacio Technologies, Inc. Sanmark - Filial af Arcio techrologies, Tac. USA
nagistrar UA 10: 106
hagistrar abuce Contact Enails abuselascio.con
sagistrar Abuse Contact Phone: #1.4165180123
‘oman Status: ole httpes/scann.ore/epotok

agistey Registrant 1D: tot Disclosed
agistcont Hane: Hot Disclosed
agiztrant Organization: Wot Disclosed

hagiztey admin 1D: sot oieclowed

2. RECOPILACION DE INFORMACION 0 FoOTPRINTING &

Se pueden ver las fechas de creación y expiracién del dominio, los datos del
registrador y los datos del registrante, que en su mayoria aparecen ocultos
También se muestra información de los servidores de nombres autorizados.
En algunos casos, en el apartado Domain Status se encuentran los valores
serverDeletedProhibited, serverTransferProhibited y serverUpdateProhibited,
para indicar que el dominio no se puede eliminar, transferir 0 actualizar. Es una
medida de seguridad para evitar que alguien cambie los DNS del dominio,

Un mensaje interesante que aparece en la salida del comando es el siguiente:
«The Registry database contains ONLY COM, NET, EDU domains and Registrars»,

‘Como se ha explicado anteriormente, la ICANN solo gestiona los dominios gTLD,
por lo que [a información de whois para el resto de los dominios hay que consul-
tarla a otros servidores.

El comando whois trata de determinar autométicamente el servidor whois ade-
‘cuado al nombre de dominio consultado, y si no puede hacerlo utilizara por de-
fecto whols.arin.net. También se puede emplear la opcién ~h para indicar qué
servidor se desea utilizar en Ia consulta, Si hay dudas puede utilizarse la opcién
~-verbose para que muestre información de los servidores a los que se realizan
las consultas.

A continuacién se muestra la información que puede obtenerse del dominio
iberdrolaes:

$ whois iberdrola.es:
Este TLD no diepone de servidor whois, pero puede acceder a la base de
datos de whois en https: //wwn.nic.es/

En el caso de los dominios .es, aunque la consulta se considera publica, la entidad
responsable Red.es exige una autorizacién previa para poder usar este servicio en
linea de comandos.?

La alternativa seria usar la herramienta web disponible en la pagina de domi-
nios.es. La Figura 28 muestra los dominios registrados y disponibles para el do-
minio iberdrola.es.

 procedimianto de acceso al servicio whois da dominios 2,
https! wu: clominios25/@a/s0bre-dominios/valores-anaclidas/whois-42



B 2. RECOPILACION DE INFORMACION 0 FoOTPaIRTING

seein * Reged. Yr datos
Ibetoiacomes x Regio. Yrs

erdlowroes i a a
Iberolo gob ee ’ a toe
lberoloedee Ce oe

Figura 2.8. Dominios esparioles registrados con el nombre berdrola. (Fuente: wwwdominios.es)

Figura 29. Datos del dominio iberdrolaes. (Fuente: wuw.dominios.es)

Los datos de los dominios registrados se pueden consultar haciendo clic en el enla~
ce Ver datos. Tras hacer clic, la información disponible para el dominio iberdrola.es
se muestra en la Figura 2.9. La información de persona de contacto administrative se
puede desplegar para conocer el nombre de la persona que se encarga de ello

2.3.2. Herramientas en linea de comandos

EI sistema operative dispone de comandos con los que puede obtenerse informa-
cién de DNS. Entre otros, cuenta con los comandos host y nslookup.

2. RECOPILACION DE INFORMACION 0 FoOTPRINTING &

El comando hest se usa habitualmente para obtener la direccién IP de un deter-
minado nombre de dominio.

§ host www.google.com
ee-google.com has address 142.250.201.683,

war.google-com has IPv6 address 2a00:1450:4003:

08: +2008

También puede realizar consultas a servidores de nombres. La respuesta mos-
trara por defecto los registros A, AAAA y MX que se obtengan. Se pueden usar
los parametros -t para especificar el tipo de registro que se desea mostrar, y -a
para mostrar todos.

El siguiente cuadro muestra la ejecucién del comando hest consultando al servi
dor DNS de Google por el dominio iberdrola.es.

iberdrola.es has address 217.22.97.1
iberdrola.es nail is handled by 10 iberdrola.in.tmes.trendmicro.eu.

En este otro ejemplo, se anade el parémetro ~a para ver todos los registros is-
ponibles (la salida se muestra abreviada).

F host <2 dherdrola.ce



B 2. RECOPILACION DE INFORMACION 0 FoOTPaIRTING

Ademas de los comandos disponibles en el sistema, existen multitud de scripts
para automatizar la enumeracién DNS, entre ellos:

+ dnsrecon (hitps://github.com/darkoperator/dnsrecon). Herramienta escri-
  taen Python que permite realizar comprobaciones de transferencia de zona,
  realizar fuerza bruta mediante diccionario para el descubrimiento de subdo-
  minios, eteétera

‘¢ dnsenum (https://github.com/fwaeytens/dnsenum). Es un seript multiilo es-
crito en Perl para obtener información DNS de un dominio y descubrir rangos
de IP no contiguos. Realiza pruebas de transferencias de zona, y descubri-
mientos de subdominios mediante busquedas en Google y mediante fuerza
bruta, entre otras operaciones.

¢ dnsdiets (https://github.com/vanhauser-the/the-ipv6). és parte del conjun-
to de herramientas IPv6 Attack Toolkit desarrollado por el grupo THC (The
Hacker Choice, https:| /www:the.org/), los creadores de Hydra (Apartado 5.25
subapartado «Herramientas de cracking online de contrasenas»). Dasdicté
es una herramienta de fuerza bruta de subdominios que emplea IPv8, a me-
nudo olvidado por los administradores de sistemas y que puede dejar agu-
jeros de seguridad.

* dnsmap (https://github.com/resurrecting-open-source-projects/dnsmap).
  és una herramienta para buscar subdominios mediante técnicas de fuerza
  bruta

* dnswaik (inttps://github.com/davebarr/dnswalk). Es un depurador DNS de-
  sarrollado en Perl. El objetivo es testear la configuracién DNS en busca de
  fallos o inconsistencias,

* fierce (https://github.com/mschwagerfierce). Es una herramienta de reco-
  nocimiento DNS para localizar direcciones IP no contiguas de un dominio.

 knockpy (https://github.com/guelfoweb/knock). Es una herramienta para
enumerar subdominios mediante uso de diccionarios y configurando una API
Key de Virus Total, que segiin el autor de la herramienta es el método que
ofrece mejores resultados. Esta clave se puede obtener de forma gratuita
previo registro en www.virustotal.com.

Muchas de estas herramientas estén disponibles en los repositorios de Kall Linux,
por lo que se pueden instalar fécilmente con apt install si no vienen instala-
das por defecto. En la Figura 2.10 se muestra el resultado obtenido por dnsrecon
para el dominio iberdrola.es.

e |

2. RECOPILACION DE INFORMACION 0 FoOTPRINTING &

= ACTIVIDAD PROPUESTA 2.1

Instala y prueba las distintas herramientas en Kali Linux y compara los resul-
tados que se obtienen en cada una de ellas.

Figura 210. Empleo de la herramienta dnsrecon sobre el dominio iberdrola.es.

2.3.3. Obtencién de subdominios mediante fuerza bruta

No siempre se puede obtener toda Ia informacion en los registros o servidores DNS.
Muchos de los subdominios que puede tener un determinado dominio no estardin
registrados en estos servidores DNS pablicos, por lo que la formai de averiguat si
existen ono es hacer la consulta y esperar la respuesta, Para ell, se utlizan diccio-
narios que incluyen los nombres de subdominios mas comunes y mediante herra-
mientas se prueban uno a uno. Esta técnica se conoce como DNS rutting. Existen
multtud de diccionarios especificas con nombres de subdominios para probar
(apartade 524). Ademés, las herramientas suelentraer sus propios diccionarios,

A continuaci6n se muestra de forma esquemética cémo se puede realizar DNS
rutting con algunas de las herramientas en linea de comandos mencionadas
en el apartado anterior.

‘fierce —-domain <dominio>
dnsenum <dominic> -£ <diccionaric>
dnsdict6 <dominio> <diccionario>
dnemap <dominio> -w <diccionario>
dnsrecon -d <dominio> -D <diceionario>

a


B 2. RECOPILACION DE INFORMACION 0 FoOTPaIRTING 2. RECOPILACION DE INFORMACION 0 FoOTPRINTING &

1 ACTIVIDAD PROPUESTA2.2

Prueba alguna de estas herramientas con diferentes diccionarios y compara
los resultados que se obtienen.

2.3.4. Obtencién de subdominios mediante certificados digitales

£1 andlisis de los certificados digitales emitidos para un determinade dominio
es una buena forma de obtener subdominios ocultos. En muchas ocasiones las
‘empresas desconocen que esta información es accesible de manera publica
dejando esos dominios desprotegidos y con acceso a internet. Para obtener esta
información se emplea ct-exposer!*

Esta herramienta, desarrollada en Python, utiliza el protocolo experimental
Certificate Transparency, creado para auditar de forma publica los certifica~
dos emitidos por una CA (Certification Authority) para un determinado dominio.
Para instalar la herramienta es necesario clonar el repositorio primero en nuestro
equipo.

de observar en la salida la lista contiene 117 dominios. Los dominios més intere-
santes son los que no tienen entradas DNS porque son potencialmente aquellos
‘que pueden pertenecer ala red interna (la salida se muestra abreviada).

§ ./ct-exposer.py ~d iberdrola.con
[+]: Downloading domain list from ort-sh...
[+11 Download of domain list complete.

[+]: parsed 117 donain(e) from list. »

$ cd /opt ie
$ git clone https://github.con/christ0s/ct-exposer.git dasa wey. jota-nc, dberdrota.com
$ ed ct-exposer none tiny. nossosvalores. iberdrola.com
§ pip3 install -r requirenents.txt none tiny. nuestrosvalores.iberdrola.com
§ sudo chnod +x ct-exposer.py none tnv.ourvalues. iberdrola.com
none tninv.portal.ve. iberdrola.com
Vamos a probar su funcionamiento con el dominio iberdrola.com. Como se pue~ none wawSspy.iberdrola.com
none _xmgervices. iberdrola.com

[+]: Domains found:
13.69.68.13 _accesojunta-iberdrola.com
34.251.183.79 accionistasnews. iberdrola.com
146.255.96.213 appsecrett. iberdrola.com

157.225.232.45 appsus-enroll..iberdrola.com

13.69.68.13 ava. dberdrola.com
2.17.37.25 blog. dberdrola.com
2.17.37.162_blogd. iberdrola.com

187.51.16.186 _ vop2.br.uc. iberdrola.com
217.22.104.99 vbp2.es.uc.iberdrola.com
157.225.100.140 vop2.us.uc. iberdrola.com
13.69.68.13  wiw-accesojunta. iberdrola.com
161.156.70.88 wine. investorday. iberdrola.com
440.114.194.188 www. junta360.iberdrola.com

217.22.97-105 ww5.dberdrola.com

[+]: Domains with no DNS record:
none *-dberdrola.com

none apps-enroll. iberdrola.com
none data-enroll.iberdrola.com
none datauk-enroll..dberdrola.com

Se puede emplear la opcién -m si solo interesa obtener las direcciones IP y no
los nombres de dominio, y la opcién -u si solo interesa obtener los nombres de
‘dominio y no las direcciones IP. En los repositorios de Kall Linux se dispone de una
herramienta similar, certgraph,

“= Repositorio en GitHub de ct-exposer (en inglés) https//github.com/chris408)ct-exposer

 cémo funciona el protocolo Certificate Transparency (en inglés)
nitps/ Jeeriieatetransparency:dev/nowetworks/

aL

1 ACTIVIDAD PROPUESTA2.3,

Prueba el funcionamiento de eertgraph y compara los resultados con los ob-
tenidos por ct-exposer.

# OCR Extracted Content from Images 100, 102, 104, 106, 108

6

B 2. RECOPILACION DE INFORMACION 0 FoOTPaIRTING

2.3.5. Transferencias de zona

La transferencia de zona es el proceso por el cual se copia el contenido de un
servidor DNS principal a un servidor DNS secundario. Existen dos tipos de transfe-
rencias de zona:

+ Transferencia de zona completa (AXFR). En esta transferencia de zona, el ser-
  Vidor DNS secundario copia completamente el fichero de zona. También se
  conoce como AXFR, que es e! nombre de la consulta  peticién en el protoco-
  lo DNS que se utiliza para realizar esta accién,

+ Transferencia de zona parcial (1XFR). En este caso, el servidor secundario
  consulta los cambios del fichero de zona tras la titima actualizacién y los in~
  corpora a su archivo de zona,

Como medida de seguridad, e! servidor principal debe estar contigurado para fi-
trar las direcciones P de los servidores secundarios que pueden realizar la trans-
ferencia de zona; de lo contrario seria posible obtener todos los datos del servidor
primario, incluidos los registros DNS de Ia red interna, Por ejemplo, esta configu-
Tacién de seguridad se puede realizar en el servidor DNS BIND «através del fichero
Jete/named.cont. A continuacién se muestra un ejemplo de como podria hacerse,

# /etc/named.cont

acl servidores-de-confianza (
192.168.0.100; //Servidor DNS secundario
192.168.1.200; //Servidor DNS terciario
h
zone zonetransfer.ne (
‘type master;

file "zones/zonetransfer-ne";
allow-transfer { servidores-de-confianza; };
h

En el cuadro anterior se puede ver la configuracién de la ACL servidores-de-
confianza que contiene las IP de dos servidores de nombres secundarios. A
continuacién, se especifica para la zona zonetransfer.me mediante la directiva
allow-transfer Ia lista de servidores DNS de confianza autorizados a realizar las,
transferencias de zona.

El dominio zonetransfer.me'® ha sido creado por Robin Wood y configurado
de forma insegura para permitir transferencias de zona con fines educativos y

* article sobre el dominio Zonetransfere nla web de DigiNinja (en inglés).
  itp Iegininjal project snetransermeshe

2. RECOPILACION DE INFORMACION 0 FoOTPRINTING &

de concienciacién en sus auditorias. Robin es creador de la web https://dighninja
donde se publican articulos y laboratorios de ciberseguridad. También es creador
de la aplicacién web vulnerable DYWA (Damn Vulnerable Web Application), que se
ultlizarG en las explicaciones de hacking web en la Unidad 4, Ademnés, es cofunda-
dor de la SteelCon, conferencia de ciberseguridad que se lleva a cabo en Inglaterra,

Para realizar la demostracién de Ia transferencia de zona se usaré el comando
dig. El primer paso es obtener los servidores de nombres autorizados para el do-
minio en cuestién,

$ dig @8.8.8.8 zonetransfer.me ns tshort.
nsztml.digi-ninja.
nsztm2.digi-ninja.

La opcién ns significa que desean obtenerse los datos de los servidores de nom-
bres (name servers) y con la opcién +short la salida del comando se muestra
abreviada

Ahora se puede realizar la peticién de transferencia de zona a cualquiera de los
dos servidores de nombres. En una auditoria se deberla probar ambos, puesto
que es posible encontrarse con que uno esté bien configurado pero el otro no.
Con la opcién axfr del comando dig se realiza la peticién de transferencia de
zona completa al servidor @nsztml.digi.ninja para el dominio zonetransfer.me
(la salida se muestra abreviada).

1 aig acts (nevtnl.digh-ninja sonetranefor.ne

"Hp. tep.sonetranefer-re. 4000

a 7


2

B 2. RECOPILACION DE INFORMACION 0 FoOTPaIRTING

‘by Robin Wood = robinbdigi ninja. see hetpr/(digi.ninja/erojects/sonetranaferne.php for more information.”
ea ee Yat ne AMMA 2004, 67es 2001s s0t00:1222

‘Como se observa, la respuesta incluye todos los registros de la zona, una infor-
macién muy valiosa para el test de intrusion. Para un análisis detallado de toda
la Informacion obtenida se recomienda leer el articulo en la web de DigiNinja.

De toda Ia salida destacan los registros NS, que estén dando informacion de los
servidores de nombres para la zona internal.zonetransfer.me. Si estos servidores
de nombres estén también mal configurados, se podrian obtener los registros
DNS de la red interna de la compania. A continuacién se comprueba si es posible
(la salida se muestra abreviada).

1 dig axfe Fintael.sonstranefer.ne internal. sonetranafer.ne

2. RECOPILACION DE INFORMACION 0 FoOTPRINTING &

‘Ademéis, la opcién ~a de la herramienta dnstecon activa la prueba de transfe~
rencia de zona.

ACTIVIDAD PROPUESTA 2.4

Prueba a realizar la transferencia de zona con alguna de las herramientas vis-
tas hasta ahora,

2.3.6. DNS Cache Snooping

Esta técnica consiste en consultar al servidor DNS si un determinado dominio
esté almacenado en la caché; de este modo se podrian averiguar los sitios por
los que los usuarios de la organizaci6n navegan!®

La información que se puede obtener con esta técnica seria valiosa para dise-
fhar ataques de ingenieria social, porque es posible saber la frecuencia con la que
se visitan determinadas paginas jugando con el tiempo de almacenamiento en
caché, y el tipo y versiones de software que se descargan en la organizacién. Si
esta información se obtiene con acceso a la red interna, se podtia utilizar el fra~
‘mework Evilgrade, que permite inyectar actualizaciones de software maliciosas.
Para poder realizar este ataque se debe haber realizado previamente un ataque
Man-in-the-Middlle al objetivo (Apartado 6:31). Esta inyecci6n de actualizaciones
maliciosas solo seré posible siel software que se trata de actualizar no comprueba
que la actualizacién tenga una firma digital correcta, algo que no es demasiado
comén actuaimente.

Con la opci6n -t snoop de Ia herramienta dnsrecon puede comprobarse si un
servidor DNS responde a este tipo de peticiones:

dnsrecon —d <dominio> -n <nombre_servidor> —t snoop -D <diccionaric>

Y asi es, se han obtenido los nombres y las direcciones IP de dos routers CISCO,
del controlador de dominio, de un servidor de archivos y del servidor de correo.

El comand hest también se puede emplear para realizar la misma operacién:

¢ host -t ns <dominio»: para obtener los servidores de nombres del dominio
indicado,

¢ host -1-a <dominio> <nombre_servidor>: la opcién I realiza la transferencia
de zona y ~a muestra todos los registros de la zona,

2.3.7. Basqueda inversa de direcciones IP

La bisqueda inversa de direcciones IP (reverse IP lookup) consiste en averiguar el
nombre de dominio « partir de una diteccién IP. Para realizar la resolucién inversa,

° aticule sobre reports de vunerablidades ONS an Windows Server (en ings)
tps learn mirosot com /er-us/ troubleshoot windows-aervernetworingidns-
Sefver-cochersnooping-atacks



B 2. RECOPILACION DE INFORMACION 0 FoOTPaIRTING

DNS dispone del registro PTR”, que es lo contrario al registro A. Los filtros antispam,
suelen utilizar el registro PTR para comprobar si la IP de un determinado correo es
legitima para realizar el envio con el nombre de dominio indicado en la cabecera,

En las labores de auditoria del hacker ético la busqueda inversa permite des-
cubrir si una IP tiene asociado més de un nombre de dominio. El objetivo princi
pal es conocer si hay otros dominios alojados en el mismo servidor web (shared
hosting). Si esto fuera asi, si alguno de los servicios alojados fuera vulnerable
se comprometeria el servidor completo, Hay numerosos ejemplos de hackeos
que se han producido de este modo. Es recomendable leer el articulo de Rafay
Baloch para conocer alguno de estos casos.”

Para realizar este reconocimiento se pueden emplear el comando host y la herra~
mienta dnsrecon del siguiente modo.

host -t PIR <ip>
dnsrecon -t xvl -r <ip_inieial-ip final>

2.3.8. Herramientas de qutomatizacion

En este apartado viene explicGndose el proceso de reconocimiento DNS empleando
consultas y comandos de manera manual y con algunos scripts de reconocimien-
to. En el presente apartado se hard mencién a dos herramientas que automatizan
el proceso de reconocimiento DNS: sublist3r y spiderfoot. En el Apartado 2.4.6 se
vverd otro conjunto de frameworks para OSINT con mucha mayor funcionalidad que
incluyen también herramientas especificas para reconocimiento DNS,

Sublist3r

Es un script escrito en Python que utiliza OSINT para enumerar un dominio. utiliza
los buscadores de Google, Yahoo, Bing, Baidu y Ask. También emplea Netcraft,
VirusTotal, ThreatCrowd, DNSdumpster y ReverseDNS. Se puede instalar en Kali
desde los repositorios con apt!”

Incorpora ademés el script subbrute para Ia busqueda de subdominios me-
diante fuerza bruta usando diccionario, que se ha incorporado a la herramienta
sublist3r mediante la opcién --bruteforce. Esta opcién puede ser bastante lenta,

 articule de Clouditare, Qué a5 un registro PTR de DNS?
https: ww.cloudiare.com|es-es/loarning|dns/dns-records/dns-ptr-recora|

"8 How Hackers Hack Into Websites On Shared Hosting (en inglés).
https uwww.rafayaloch com/2017/08/now-hackers-hack-into-websites-on html

"* Repositorio oficial de sublist3 (on inglés) htps://github.com/aboulsia/Sublist3r

» |

2. RECOPILACION DE INFORMACION 0 FoOTPRINTING &

En la Figura 2.1 se muestra el uso de la herramienta para reconocer el domi-
lo repsol.com. Como se observa, la herramienta encuentra cuatro subdominios
nices sin emplear la opcién de fuerza brute.

Figura 2.1, Subdominios encontrados con la hertamienta sublist2r para el dominio repsolcom

Spidertoot

Es otra herramienta desarrollada en Python que emplea OSINT para el reconoci-
miento DNS. Dispone de una version profesional, SpiderFoot HX”, con opciones
avanzadas sobre la versién open source.

spiderfoot esté disponible en a instalacién base de Kall. Los scripts se encuen-
tran en el directorio /usr/share/spiderfoot y Kali dispone de los comandos
spiderfoot y spiderfoot-cli,ya que es una herramienta que funciona en modo
cliente-servidor.

Con spiderfoot -|ip:puerto se arranca el servicio de Spiderfoot. El servidor se
arranca en la maquina local en el puerto 5009.

§ spiderfoot -1 127.0.0.
Starting web server at htty

25009
Pecalhost :5009

Use SpiderFoot by starting your web browser of choice and
browse to http://localhost:5009

[Wb oficial de spiderfoot (en inglés). https wuw-spiderfoot net


B 2. RECOPILACION DE INFORMACION 0 FoOTPaIRTING

Una vez arrancado el servicio, se abre el navegador y se introduce la direccion
localhost:5009 para ver a interfaz web de Spiderfoct. La ventana Seans contie~
he el historia de los escaneos que se han realizado o los que se estan ejecutan-
do.en ese momento, yen Settings se puede modificar la configuracién global de
Ia herramienta, ast como introducir API Keys para distintos servicios ontine que
permitan mejorar las capacidades de recopllacién de información. Para iniciar
Un escaneo se abre el mend New Sean (Figuta 22).

Eee
@ veto omen] ‘i on

Scans

Figura 212. Creacién de un nuevo escaneo en Spiderfoot.

En el formulario se indican el nombre que se dar4 al escaneo (Sean Name), la
URL del objetivo (Sean target) sobre la que se desea realizar la busqueda, y el
motivo del escaneo organizado en varias pestafias y botones de seleccién (Fi-
{gura 2.12). Se elegiré la opcién Feetprinting en la pestaria By Use Case. Otra op-
clén atin més silenciosa seria Passive para limitar todavia més las interacciones

wero [Omen] wae Fm a om]

A emcee

Figura 213. Formularlo para configurar un nuevo escaneo en Spiderfoot.

2

2. RECOPILACION DE INFORMACION 0 FoOTPRINTING &

con el objetivo. Se finaliza pulsando en Run Scan Now y esperando a que co-
miencen a llegar los resultados al servicio web.

En la terminal donde se arranca Spiderfoot se puede observar cémo se estan
realizando multitud de peticiones. El escaneo es lento y puede durar horas. La
Figura 2.14 muestra un escaneo en proceso para el dominio iberdrola.com lan-
zado anteriormente. Estos resultados se encuentran en el mend Scans.

‘Scans
Yrs |= ol: az

Figura 2.14, tistado de los escaneos realizados © en proceso en Spiderfoot.

En esta ventana se puede ver que el escaneo se encuentra en proceso y los ele-
mentos encontrados hasta el momento. También se puede detener o clonar el
‘escaneo en la columna Aetion. Para ver los detalles del escaneo se debe hacer
clic sobre el nombre de este.

1 ACTIVIDAD PROPUESTA2.5

Utiliza Spidertoot para realizar un andlisis de un dominio de tu eleccién. Deja
la herramienta funcionando durante varias horas y comprueba los resultados
cobtenidos.

2.3.9. Herramientas visuales

‘Ademas de las herramientas en linea de comandos que se han utiizado, se pue~
den emplear paginas web que ofrecen esta información:

¢ www.domaintools.com ofrece servicios avanzados y de pago para threat
intelligence.

+ wwwrobtex.com recopilainformacién de direcciones IP, DNS y AS (Autonomous
  system) de fuentes pablicas y con una sola consulta

+ www.neteraft.com esté enfocada al ambito empresarial para la proteccién
  de servicios. En la seccién de recursos (resources) tiene herramientas para la
  busqueda DNS, entre muchas otras.

2



B 2. RECOPILACION DE INFORMACION 0 FoOTPaIRTING

"

¢ www.virustotal.com se centra en la deteccién de malware, tiene una seccién
intelligence donde utiliza Google y Facebook y una API para obtener informa-
cién de todo tipo,

+ https://ansdumpster.com/ devuelve, a través de una consulta sencilla de un
  dominio, toda la información relativa a este: servidores de nombres, de correo
  y otfos hosts asociados, incluyendo información del software, por ejemplo
  tipo y version de los servidores empleados. Quizés, lo més interesante sea que
  elabora un mapa de relacion entre los diferentes equipos descubiertos.

2.3.10. Transformadas de Maltego

También es posible emplear las transformadas de Maltego (Apartado 2.4.6)
para obtener información sobre ONS.

‘4 DNS from Domain > Other transforms > Domain using Mx (maill server). Trans-
formada encargada de obtener los servidores de correo asociados al dominio.

‘DNS from Domain > Other transforms > Domain using NS (name server). Trans-
formada para obtener los servidores de nombres asoclados al dominio.

+ se selecciona el conjunto de servidores obtenidos (MX y NS) y se ejecuta Resolve
  'P sobre ellos.

‘¢ Se vuelven a agrupar, esta vez sobre las direcciones IP, y se ejecuta Resolve IP >
IP owner detail

Una vez que se ha conseguido Ia información basica se puede obtener mas infor-
macién con otras transformadas: Other transforms > To website where IP appear.
Se realizan busquedas por las direcciones IP en los principales buscadores.

2.4. Técnicas y herramientas para recopilar
información

Existe una infinidad de herramientas para recopilar todo tipo de Informacién. En
‘esta seccién se aborda un gran nimero de ellas que hemos tratado de clasificar
‘en funcién de su utilidad. En primer lugar se verén algunas técnicas y herramien-
tas que pueden emplearse para analizar un sitio web, certificar su contenido y
ver los cambios que se han producido en este, En segundo lugar, se explican
diferentes técnicas de recopilación de información en buscadores generalis~
tas como Google o Bing, y otros buscadores especializados. En tercer lugar, se
analizan las técnicas y herramientas que se pueden utilizar para buscar infor
macién en ficheros, tanto en su contenido como en sus metadates. A continua~
cién, se explican distintas herramientas para buscar información personal, como

|__ 2 SecaPnacion ae ingonmacion 9 FoorPaunring &

nameros de teléfono, redes sociales o direcciones de correo. Posteriormente, se
ver que existe informacion procedente de brechas de seguridad, servicios que
han sido comprometidos previamente, y que se pueden consultar. Por Ultimo, se
destacarén algunos de los frameworks més completos que permiten realizar las
tareas de OSINT de forma integrada desde una sola interfaz

Si se desea conocer mas sobre todas las herramientas disponibles para OSINT,
s recomendable consultar los siguientes recursos:

4. OSINT Framework (https:/osintframework.com/). Web interactiva donde las
   herramientas y recursos se clasifican por categorias. Las categorias se van
   desplegando conforme se pincha sobre cada una de ellas (Figura 215).

+ Ciberpatrulla oSINT (https;//ciberpatrulla.com/links/). Web para buscar herra~
  mientas clasificadas por categorias.

.

OSINT.LInk (inttps://osintlink/). Web con un listado de recursos clasificados
por categorias.

4 OSINT Techniques (https;//inteltechniques.com/book\.htm)). Libro con més de
36 capitulos y 500 paginas que va ya por su 10* ediclién, Se puede comprar a
través de Amazon. En la seccién Resources de la web de intelTechniques tam-
bién se pueden encontrar otros recursos accesibles de diferentes temas.

.

OSINT Handbook (https://i-intelligence eu/resources/osint-toolkit), Un docu-
mento de més de 500 paginas con multitud de herramientas para OSINT.

on te hn et
“Email Verification pt pecan
— Chae
soe eon a ome
— OAshiey Madison Emaiis

“epdane Nunbers
Pie Rees
aes Races
——
Search gine
Fru egs RCO
Art

aguas Tatton ©

st Framewerk©-

Figura 216, Hrramiontas que se pueden emplear para buscar drecciones
de correo electronico que dparecon en brechas de informacion
(uonte htps/fosintramenorkcorn).

# OCR Extracted Content from Images 110, 112, 114, 116, 118

B 2. RECOPILACION DE INFORMACION 0 FoOTPaIRTING

*

El canal de YouTube de The Cyber Mentor dispone de un curso sobre OSINT?! de
5 horas que también supone un gran recurso de aprendizaje de diversas técni-
cas y herramientas.

Por dltimo, es importante saber que el uso de herramientas per se no garantiza
1 éxito, El uso de las herramientas debe integrarse dentro de un proceso de tra-
bajo, de una metodologia que maximice el éxito de la fase de footprinting. Este
‘enfoque metodolégico se adqulere con la practica y la experiencia. Por ello, es
recomendable tener siempre presentes las metodologias de pentesting que se
‘estudiaron en la primera unidad.

Jason Haddix (@jhaddix) es e! autor de la propuesta metodolégica The Bug
Hunter's Methodology que ha sido presentada en diferentes conferencias de segu-
ridad como DEFCON y que actualmente esta en su versién 4, Se recomienda visionar
los videos”? donde explica en qué consiste su propuesta ya que contienen consejos
muy tes.

24.1

El reconocimiento de la web objetivo es una tarea importante porque va a per-
mitir recopilar información valiosa. En las siguientes secciones se tratara lo si-
guiente:

Reconocimiento web

¢ Descarga completa del sitio web para su análisis local.
‘¢ Como examinar versiones anteriores del sitio web.
‘¢ Como obtener un testigo online del estado del sitio web.

Descarga de un sitio web

Con esta accién se obtiene una copia local de todos los ficheros del sitio respe-
tando su estructura, lo que puede dar una idea de cémo se organiza la informa-
ci6n. No se descubre información oculta, pero podria hallarse información que
se ha enlazado en un lugar pablico sin que el administrador del sitio se haya
percatado de ello,

Por ejemplo, los comentarios HTML suelen ser un lugar donde se obtiene in-
formaci6n puesto que ese texto se envia al navegador y queda a la vista de

2" curso de TCM. Open-Source Inteligence (OSINT) in S hours (en inglés).
hitps! youtube/qwas\imbecne

22 videos de Jason Hacdt sobre metodologa an la bdsqueds de vunerabldaces (en inglés).
The bug Hunters Methodology v4.0 Racon Eaton haps! youtube] paigluimes!
The Bug Hunters Methodology. Application Analysis vt tp fyoutube/HmDY7W8AER4

] 2 RECOPILACION OE InFoRMaciON O FooTPRIATING &

‘cualquiera que lo inspeccione. Otros elementos que se pueden encontrar son
direcciones de correo, nombres de subdominios, indicios de configuracién del
servidor 0 la aplicacién web, archivos con contenido privado y metadatos con
información relevante.

La herramienta wget, permite descargar desde la linea de comandos un sitio
web completo lo que facilita la automatizacién de esta tarea mediante scripts.
El siguiente comand realiza la descarga completa del sitio web www.example.

restrict-file-names-unix \
domains example.com \

El significado de cada una de las opciones utilizadas es el siguiente:

.

recursive. Se exploran los hiperenlaces de forma recursiva, lo que permite
realizar la descarga completa del sitio.

no-clobber. Indica a wget que no sobrescriba un fichero en una carpeta si
se descarga otro con el mismo nombre. En este caso se crearé otro fichero
con el mismo nombre afiadiendo.1,.2, eteétera

page-requisites. Obtiene todos los ficheros de los que se compone una
pagina web (imagenes, CSS, Javascript, eteétera),

htmi-extension. Guarda los ficheros con extensién html

-convert-links. Transforma los hipervinculos para que sean navegables de
forma local.

restrict-file-names. Esta opcién permite restringir los caracteres incluidos
en los ficheros para escapar posibles caracteres peligrosos en el sistema
operativo, Los valores posibles son windows, linux, nocentrol, ascil, lowercase
y uppercase,

dounload an entre website wth wget (en ingle),
htipe/ wewtinujoumnalcom[content/downleading-entie-wob-sito-mget



B 2. RECOPILACION DE INFORMACION 0 FoOTPaIRTING

‘¢ ~-domains. Lista de dominios que seguir. Esta opcién es necesaria para no
descargar enlaces que referencian otros sitios web.

¢ ~-no-parent. En caso de que la URL que se busca no se inicie en la carpeta su-
petior del sitio, evitaria que se descarguen archivos de directorios superiores.

Versiones anteriores del sitio web

Los cambios que ha tenido una web a lo largo del tiempo pueden revelar in-
formacién interesante, como cambios en el uso de Ia tecnologia empleada o
información eliminada que anteriormente estuvo disponible pUblicamente. Esto
se puede realizar explorando Ia historia de un sitio web a través de servicios que
almacenan copias completas del estado de todas las webs de Internet.

‘The Wayback Machine (inttp://web.archive.org) es uno de los lugares més visi-
tados para recuperar información de sitios web que han desaparecido. La web
‘comenz6 a realizar capturas de todos los sitios web de internet en 1996 y actual
mente dispone de mas de 700 000 millones de paginas web indexadas. Ade-
més, realiza una labor bibliotecaria, recuperando software, juegos e imagenes
de otras épocas, que de otro modo desapareceran. Incluso muchos juegos de
videoconsolas antiguas se pueden jugar en linea en su web.

Para navegar por las distintas versiones de un sitio web se introduce Ia URL en el
‘cuadro de bisqueda. Se mostraré la maquina del tiempo desde la que se puede
Vigjar a cualquier fecha pasada en la que se haya realizado una copia de ese
sitio. Los dias en el calendario que se muestran en esferas indican que ese dia
se realiz6 una copia; un mayor tamano de la esfera indica que se han realizado
més copias (Figura 2.6). Las copias que se realizan no son un indicative de que
€l sitio web se haya modificade © no, es simplemente el momento en el que se
ha guardado el estado de la web, Ademés, la web ofrece una API con la que se
pueden comparar dos versiones” de un sitio web, de modo que es posible de-
sarrollar scripts propios para analizar los cambios més relevantes.

También es posible realizar una copia del estado de un sitio a peticién propia
por sien el futuro se quiere utilizar esa información; por ejemplo, para obtener
pruebas sobre clerta información publicada que puede ser borrada. En Espana
hay casos judiciales en los que se ha aceptado como prueba la información de
‘The Wayback Machine, pero en otros casos no, por lo que siempre sera reco-
mendable utilizar los servicios de testigo online que se mencionan en el siguiente
apartado.

> Comparar dos versiones de un sitio web en The Wayback Machine (eninglés).
> htpe/ farchivearg/developers/tutorial-compate-shopshot-wayback htm

*

] 2 RECOPILACION OE InFoRMaciON O FooTPRIATING &

autores,

Figura 216. nformacién almacenada en The Wayback Machine para el dominio Iberdrola.com.
(Fuente: htp//webarchive.org).

Otro sitio web similar es archive.today, si bien en este caso no se realizan copias
‘utomaticas de todo internet, sino que solo se almacenan las copias solicitadas
por los propios usuarios. Otra alternativa es utilizar la caché de los buscadores web;
1 sitio cachedview.com ofrece un buscador de sitios web de la caché de Google.

Testigo online de un sitio web

Los servicios conocidos como testigos online*® sirven para certificar el conteni-
do que aparece en una web, de modo que, si desaparece, el testigo sirve como
prueba de que ese contenido ha existido. A continuacién se mencionan dos
herramientas:

+ eGarante (ihttps://www.egarante.com/). és un servicio online que certifica
  pruebas de contenido en tres servicios: correo electronic, web y entrega de
  documentos. Dispone de acceso limitado para uso personal y versiones de
  pago para uso profesional

+ Save the Proof (https://mww-savetheproof.com/). similar al anterior, ncluye la

certificacién de una sesién de navegacién de hasta 16 minutos, certificacién
de tweets y otras herramientas.

* artculo sobre testigos online de INCI. https wwaincibe.es/ciudadania/blog/testigos-online-y-
  ‘obtencion-de-prusbas-te-explicamos-suutlidad

Ps



B 2. RECOPILACION DE INFORMACION 0 FoOTPaIRTING

2.4.2. Hacking con buscadores

Internet es una gran fuente de información, y los buscadores son herramientas
especialzadas en encontrar cualquier tipo de información en ella. Al escuchar
(0 leer) la palabra buscador, enseguida se viene a la mente la herramienta para
buscar paginas web. Sin embargo, en este apartado se vera que se pueden
realizar bisquedas de otros servicios y de otro tipo mucho mas complejas. De
hecho, el trmino haeking con buscadores se encuentra habitualmente en la bi-
bliogratia, como por ejemplo en el libro Hacking con buscadores: Google, Bing &
Shodan + Robtex, de Enrique Rando, publicado por Ia editorial OxWord.

Enos siguientes apartados se presentan los buscadores y las técnicas de hacking
con buscadores més utilizadas para obtener información,

Buscadores web y dorks de bisqueda

Existen multitud de buscadores web, con Google, Yahoo!, Bing, Baidu, DuckDuckGo
y Yandex como los més conocidos. Los buscadores recopilan la información gra-
clas a un erawler*® (rastreador), también llamado robot, bot o arafia, una herra~
mienta que recorre las paginas web analizéndolas y clasificando su contenido
para indexarlo. También se analizan los enlaces que contiene el sitio web para
visitarlos y comenzar un nuevo andlisis. El crawler visita los sitios web de manera
periédica, de modo que cualquier cambio o actualizacién se vuelve a registrar
‘en la base de datos del buscador.

Estos crawlers dejan huella en los registros de los servidores web a través de la
cabecera User-Agent de la peticién HTTP (Apartado 41) El siguiente cuadro
muestra las cabeceras User-Agent de los crawlers de Google, Bing, uckDuckGo
y Baidu

DuckBuckBot/1.0; (+B2tp!//duckduckgo-con/duckdsck2ot eal)
Nori11a/S.0 (compatible; Bosduspider/2.0; <nteps/hnoe-baisu.con/search/spider-html)

Hay un estandar de facto para evitar que los rastreadores indexen parte del con-
tenido de un sitio web, el archivo robots.txt. El contenido de este fichero indica qué
paginas no se desea que indexe un determinado cliente (definido por la cabecera
User-Agent). A continuacién se muestra el contenido de un fichero robots.txt.

2 información sobre el robot o crawler de Google. http|/weew.googlecom/bot htm!

User-agent: *
Disallow: /egi-bin/
Disallow: /tmp/

Disallow: /privado/
/ssp-adin/

Disallow:

En este ejemplo aparecen cuatro directorios del sitio web cuyo contenido no se
desea que se indexe por ningun crawler (User-agent: *). Sin embargo, esto no
significa que el contenido no sea visitable, es mas, el fichero robots.txt puede
ser una fuente de fugas de información si el autor no tiene esa precaucién. Por
ejemplo, en el fichero anterior, el directorio privade es facilmente descubierto
por un atacante, no hay nada més que consultar el fichero robots.txt del sitio
web. y si no est correctamente protegido se podria acceder a su contenido,

Ademés, respetar las directivas del fichero robots.txt es voluntario, por lo que
herramientas de spam o malware no solo no las respetarén, sino que las utiliza
ran como posibles puntos débiles. Por ello, no es recomendable usar este fichero
para ocultar directorios del sitio web; este principio se conoce como seguridad
por oscuridad (security by obscurity) en donde se confia la seguridad de un
‘elemento en mantenerlo oculto, una practica totalmente desaconsejable

Volviendo al uso de los buscadores para encontrar información, estos permiten es
pecificar parametros o fitros de bisqueda para obtener resultados més precisos.
Estos parémetros empleados para técnicas de hacking o descubrimiento de in-
formacién se denominan dorks. Por ejemplo, empleado en un buscador concrete
come Google, esta técnica se denomina Google Dorks o Google Hacking, Existen
dorks para descubrir nombres de usuario y contrasefias de bases de datos, ac-
ceder a dispositives hardware online como webcams impresoras, obtener datos
personales como nimeros de DNI, cuentas bancarias, etc. El sitio web Expleit-
DE mantiene una base de datos de dorks para Google conacida como Google
Hacking Database” (HDA).

Acontinuaci6n se expone una pequefia muestra de ejemplo de algunos dorks
para Google interesantes:

« Sitios con paneles de administracién de WordPress en el fichero robots.txt:
inurtrobots.tet intext“disallow: {wp-admin”

+ Listado de directorios que contienen archivos con extensién sql (copia de se~
  Quridad de una base de datos): intext:"index of "sql"

¢ Archivos con extensién sql que contienen la palabra password: filetype:sql
password

Bose de datos de dorks para Google (en inglés). tps uw explit-dlscom google-hacking-databose

] 2 RECOPILACION OE InFoRMaciON O FooTPRIATING &


B 2. RECOPILACION DE INFORMACION 0 FoOTPaIRTING

# BUsqueda de errores en bases de datos SQL: "you have an error in your sql

syntax’ inurk/events.php2id=

* Listado de directorios con contenido multimedia procedente de camaras di-

gitales o teléfonos méviles: index.of.dcim

* Listado de directorios cuya URL contiene Ia palabra superadmin: inttle:"index

of inurksuperadmin

¢ Camaras web del fabricante Linksys accesibles online: camera linksys

inurl:main.egi

La Figura 2.17 muestra un ejemplo de los resultados mostrados por Google al

‘emplear uno de estos dorks.

Google rmemmers x oa

tex imported es

Figura 217. Resultado de la busqueda en Google usando un dork
ora localizarficheros de bases de datos.

ACTIVIDAD PROPUESTA2.6

Explora la base de datos de Google Dorks de Exploit-DB (GHDE) y analiza los
resultados que se obtienen con algune de ellos.

EI ndmero de dorks disponibles es enorme por lo que realizar una busqueda ma-
nual puede ser tedioso. La herramienta pagodo”*, escrita en Python, permite
‘utomatizar este proceso. Antes de usarla, hay que tener precaucién y leer dete-
nidamente la documentacién. Realizar un numero elevado de consultas a Google
tendré como resultado el bloqueo de nuestra direccién IP por algiin tiempo, por
lo que lo recomendable es utilizar el comando a través de proxychains (Aparta-
do 251).

22 Repasitoro en GitHub de pagod (on inglés). nttps//github.com/opscisk/pagodo

2. RECOPILACION DE INFORMACION 0 FoOTPRINTING &

Para completar Ia informacion de esta seccién, la web de Chema Alonso (cono-
cido y reputado hacker espanol) dispone de dos articulos dedicados al descu-
brimiento de ficheros en un sitio web”, y aunque son publicaciones realizadas
en el afio 2013 gran parte de sus explicaciones siguen siendo relevantes en la
‘actualidad

Buscadores tecnolégicos

Los buscadores tecnolégicos no indexan contenido sino servicios, es decir, esca~
nean la red identificando los puertos actives de cada direccién IP y almacenan
información de cabeceras (banners), lo que permite identifica el tipo de software
yla version de este, Otros datos que se pueden obtener son la localizacién geo-
grGtica, el ISP que utiliza para conectarse a internet el tipo de sistema operativo
utlizado, ete. El uso de estos buscadores durante esta fase resulta interesante ya
que recopila de forma pasiva información que solo estaria disponible mediante
técnicas activas en una fase més tardia del test de intrusién

Los buscadores tecnolégicos mas conocidos son:

Shodan (https://www.shodan io/). Es un servicio freemium con diferentes ni-
veles de uso, Las busquedas para usuarios no registrados estén limitadas a
cadenas bésicas, mientras que con un usuario registrado se pueden utilizar
operadores de bsqueda y la API de forma limitada. Para usar la API se dis~
pone de una clave que puede registrarse en algunas de las herramientas en
linea de comandos que se verén en esta unidad. También es posible buscar
dispositivos por vulnerabilidades a través de su CVE, pero esta opcién solo
est6 disponible en cuentas empresariales.

+ Censys (https'//search.censysio/). Surgié como un proyecto de Investigacion
  en la Universidad de Michigan y, a pesar de haberse convertido en una enti
  dad privada, ofrece cuentas especiales para investigadores.

* Zoomeye* (https://www.zoomeye.org/). Es un buscador tecnolégico de ori
  gen chino similar a Shodan. Las cuentas gratuitas bajo registro tienen un I
  mite de datos mensuales y la cantidad de resultados de las busquedas esté
  limitada a 400, con acceso ala API. Ademés, dispone de una herramienta en
  linea de comandes y una libreria en Python para poder integrarlo en los de-
  sarrollos propios.

2 Técnicas para descubriosficheros de un sto wet.

Artcul | de hits wnlladedelmalcom/2013/04[tecricas-parc-descubr-los-theros-de html
‘cule 2 de 2h ww eladedetmalcom/2018/04/tecricas-pare-descubti-ios-ficneros-de tml

® Ureia y herramianta Cll en Python para Zooméye (en inglés).

htipe//github.com/knownsec/zoomeye-python

=—


GBs coruacin oe nronmecin overruns

Se muestra a continuacién con un ejemplo breve el potencial de estos buscado-
res. Para ello, se utilizaré una cuenta registrada en Shodan para poder hacer uso
de los filtros de busqueda. En la Figura 2.18 se muestra un pequefio ejemplo de
los filtros disponibles.

iter Name Beseription xampte
country 2 etter Country code pen porte inthe United States
napate Tite of he webste Hacked Webs

a omen ronan at curt ae

port Port number forthe sence that ieruning SSH servers

product Nome ofthe software tat POWER INE naung Smt HE
aicanteiemaaaal sd Systeme

‘Algunos de fos ftros de Shodan més habituoes.
(Fuente: htps://annwshodenio).

Figura 2.1

Por ejemplo, para encontrar todos los dispositivos indexados por Shodan en la
ciudad de Sevilla, Espana, se utiliza la siguiente cadena de bisqueda:

city:Sevilla country:Es

La Figura 2.19 muestra los resultados que se obtienen. En la columna izquierda
aparece el total de resultados obtenidos (hay dos ciudades con la cadena Sevilla
fen su nombre), 1I3 903 dispositivos conectados, clasificados también en funcién
de los puertos, las organizaciones, los productos y os sistemas operatives mas
utiizados.

wo

2. RECOPILACION DE INFORMACION 0 FoOTPRINTING &

113908

Figura 219, Resultados de una busqueda en Shodan
‘con Ia cadena city Sevilla countrys,

La busqueda se puede afinar mucho més y ahadir cualquier cadena deseada
que aparezca en el banner del servicio; por ejemplo, para buscar los servidores
Apache de la versin 2.4.29 se anadiria Apache/2.4.29. Apareceré un listado mas
reducido; si se pulsa sobre alguno de ellos se ven los detalles de este servicio. En
Ia Figura 2.20 se muestra un ejemplo de ello. La información se muestra en dos
columnas: en la de la izquierda se muestra información de los dominios asocia-
dos a la direccién IP, nombres de host, ISP, tecnologias web que se han identi
cade y la lista de CVE para las que esta version de Apache es vulnerable; en la
columna derecha se muestran los puertos abiertos (80 y 442) y las cabeceras
que se obtienen en cada uno de ellos.

Se podrian usar otras cadenas o filtros para la busqueda; por ejemplo, para
ver un listado de servicios FTP se aftadiria el filtro port:21. Para la labor de re
conocimiento que se esté estudiando en esta unidad se puede afadir el filtro
ip para obtener información de los servicios activos en el objetivo que se esté
‘uditando,

# OCR Extracted Content from Images 120, 122, 124, 126, 128

GB eeeomacin oe mronmncionromenanae | - 3 |__2 mconuncion ae ronmacion a raormnnae

+ Onion Search (hitps://onionsearchio/). Buscador especitico para Tor.

+ Dark.Fail (inttps://dark all/). s un servicio orientado a investigadores para
  comprobar la veracidad online de un servicio en Tor,

Otros buscadores especificos que solo estén accesibles desde Tor son los si-

guientes:

Haystack (http://naystakSnjemn2hqkewecpaxetahtwhsbsa6-4jom2k22250hx-
hnnpxfid.onion/). Este buscador de Tor tiene indexados 260 000 servicios ocultos.

+ Toren (http /torchdeedp3izigaidmfpnstintnhswomdaarsjvaigsp77e54dqd
  onion/).s uno de los buscadores mas antiguos

1 ACTIVIDAD PROPUESTA 2.

Utliza aiguno de los buscadores anteriores y trata de hallar algtin servicio o in-
formacién en Tor que pueda ser interesante para el médulo de hacking ético.

Figura 2.20. Detaile de uno de los servicios encontrados en Shodan
‘con la cadena de bésqueda city Sevilla countrys Apache]2.428,

Busqueda inversa de imagenes y videos

Un servicio no tan conocido de los buscadores web es la posibilidad de localizar
los sitios web donde aparece publicada una determinada imagen o video. Exis~
ten varios motivos por los que esta funcionalidad es uti:

Crea una cuenta en Shodan, explora diferentes tipos de filtros y comprueba 1
os resultados.

ACTIVIDAD PROPUESTA2.7

Comprobar el uso adecuado de los derechos de autor. si se ha subido una
imagen o video a la web para un uso exclusivo en una publicacién, se puede
comprobar si hay otfos sitios de Internet que han publicado esta imagen 0
Video sin consentimiento. El sitio web Berify (https:/berify.com/) esta espe-
clalizado en este tipo de busquedas.

2. Comprobar la veracidad o falsedad de una imagen o video que circula por
   las redes sociales. EI uso de las redes sociales para difundir bulos es muy co-
   min hoy en dia y a menudo se emplean imagenes o videos pasados que
   nada tienen que ver con Ia información que se esté dando en el mensaje.
   Para un periodista de investigacién esta es una tarea relevante cuando se
   investigan camparias de desinformacién.”

Buscadores en redes andnimas

Los servicios de estas redes estén ocultos, por lo que es necesario conocer sus

direcciones para poder acceder a ellas. Por suerte, hay algunos buscadores que

Indexan servicios de diferentes redes anénimas y que pueden consultarse a tra-

vés de Internet, aunque también disponen del correspondiente servicio onion.

Los més relevantes son:

3, Comprobar las publicaciones de un perfil en una red social. Es posi-
ble intentar localizar los perfiles que tiene actives una persona buscan-
do alguna de las imagenes pablicas de su perfil. Esto también es atil en

¢ Ahmia (https://ahmiafi). Uno de los buscadores més conocidos para realizar
bUsquedas en Tor 0 12. Censura contenido ilegal, especialmente la pornogra-
fia infantil por lo que estos resultados no se mostrardn en las bisquedas.

‘+ The Hidden wiki (https://thehiddenwikicom/). Un sitio elésico con diferentes
categorias de servicios ocultos en Tor.

rm w

> Guia avanzada sobre veriticacién de contenido de video.
> https! [ginorg/2018/08/18/guio-avarzada-sobre-vericacion-de-contenido~de-video/



ws

B 2. RECOPILACION DE INFORMACION 0 FoOTPaIRTING

ciberinvestigaciones para determinar si una cuenta es falsa y esté tratando
de usurpar la identidad de otra persona.

Los principales buscadores generalistas disponen de biisqueda inversa de imé-
genes; por ejemplo, Google (https:/ images. google.com), Bing (https://www.
bing.com) o Yandex (https://yandexcomJimages/). Las opciones de busqueda
suelen ser dos, bien utilizando un enlace, o bien subiendo la imagen que se de-
sea buscar. En la Figura 2.21 se muestra cémo acceder a la bisqueda inversa de
imagenes en estos tres buscadores.

Google

Figura 2.21. Bosquedia inversa de imagenes en los buscadores
Googie (ariba), Bing (cent) y Yandex (abajo)

Tinkye*? es un buscador especializado de imagenes que incluye opciones de
busqueda avanzadas de pago, como la busqueda a través de reconocimiento
de imagenes desde la camara del mévil o el uso de una API, entre otras, Ade-
més, dispone de extensiones para los distintos navegadores que permiten reali-
zar bisquedas desde el propio sitio web donde se encuentra la imagen.

© come usar Tingye (en inglés). https /tineye.com/how

2. RECOPILACION DE INFORMACION 0 FoOTPRINTING &

En cuanto a extensiones de navegador, el complemento Search-by-Image:*
para Firefox permite realizar busqueda inversa de imagenes empleando mas de
Un buscador, lo que también es una buena opcién para maximizar los resultados
que se desean obtener.

Para la busqueda inversa de video se emplean las mismas herramientas que en
el caso de la busqueda inversa de imagenes. En esta ocasién, para localizar un
video es necesario realizar una captura de pantalla de alguno de los fotogramas
del video que se quiere localizar. Para ello, se puede usar cualquier herramienta
de captura de pantalla, o bien, herramientas de edicién de video que permitan
extraer el fotograma deseado como imagen.

2.4.3. Andlisis de archivos

En esta seccién se estudia cémo obtener información interesante procedente de
archivos. Por ejemplo, tras haber descargado una copia offline de un sitio web
(subopartado «Descarga de un sitio web» del Apartado 2.41, anteriormente en
esta unidad) hay que analizar el contenido de los archivos para descubrir si hay
algo relevante.

Enos siguientes subapartados se estudia c6mo identificar el formato real de un ar-
cchivo, extraer los metadatos y buscar información textual en el interior de un archivo.

Identificacién del formato

El formato de un fichero ofrece informaci6n sobre su contenido. Un fichero de
texto tendré una información que puede ser leida por editores de texto con una
codificacién de caracteres specifica, Ademds, un fichero de texto puede repre-
sentar información muy diversa, como archivos de cédigo fuente o documentos
ofiméticos. Por contra, un fichero binario tendré una estructura interna comple-
tamente distinta y una codificacién adaptada a la arquitectura para la que se
ha creado.

La identificacién del formato de los ficheros es una acci6n fundamental en nu-
merosas aplicaciones informaticas que si se hace de manera incorrecta puede
‘ocasionar problemas de seguridad. Un ejemplo puede ser una aplicacién web
que permite a los usuarios subir imagenes; existen muchos tipos de formatos
de imagenes distintos, por lo que cabe preguntarse entonces qué tipos de ima-
genes van a poder subir los usuarios y de qué modo se llevara a cabo esta li-
Mitaci6n. Existen numerosas vulnerabilidades que aparecen por un tratamiento

# add-on pera Fro Search by image (on ingly)

too leasoneorta ogo’ ftofodaen earch. by_tmoge]



B 2. RECOPILACION DE INFORMACION 0 FoOTPaIRTING

@

indebido de los archivos que envia el usuario a un servidor web, conocidas como
file upload vulnerabilities (Apartado 4.42).

En general, la identificacién del formato de un archivo se puede hacer desde dos
‘enfoques:

¢ Mediante la extensién del archivo, Este enfoque tiene la ventaja de la facili
dad con la que se identifica el formato, pero es muy facil de manipular por los
usuarios por lo que es una via comin de ataque. Por ejemplo, el famoso virus
ILOVE YOU se difundié por correo electrénico con el asunto ILOVEYOU y el fi-
chero adjunto LOVE-LETTER-FOR-YOU.TXT.vbs. La extensi6n .vibs corresponde
@ Visual Basic Script, pero los usuarios solo vefan la extensi6n .txt, puesto que
Windows oculta autométicamente las extensiones de los archivos. Podia iden-
tificarse ademas por el icono, distinto al de un archivo de texto plano, pero
nadie reparé en ello. En pocos dias se produjeron 50 milllones de infecciones.

¢ Mediante el nimero magico. EI numero magico es un valor Unico y constante
en la cabecera del fichero. En este método la falsificacién del tipo de fichero
es mucho més compleja, por lo que es una forma mds segura de identtificar el
formato de un archivo.

En Linux, el comando file analiza el namero magico del archivo para identificar
su formato. El siguiente cuadro muestra Ia salida del comando al analizar una
Imagen PNG.

§ file imagen.png
imagen.png: PNG image data, 1213 x 607, 8-bit/color RGB, non-interlaced

En caso de que no se pudiera identificar el formato podria ser porque la cabe-
cera del fichero estuviera corrupta. Para analizar el contenido de la cabecera se
puede utilizar un editor hexadecimal, por ejemplo hexdump. A continuacién se
muestra la salida del comando con una imagen PNG.

hexane -C imagen-png | bead

La opcién -¢ muestra la salida en formato hexadecimal canénico (16 bytes
hexadecimales) y su representacién en caracteres ASCII, En el caso del ejemplo,
los primeros 8 bytes (89 50 4E 47 OD OA 1A 0A) corresponden al numero mé-
gico de un fichero PNG (Portable Network Graphics) y su representacién ASCII

coincide con los caracteres de Ia extensién (PNG). Los nmeros magicos de
‘cualquier formato se pueden consultar en Wikipedia *

Andlisis de metadatos

Los metadatos contienen información acerca de las caracteristicas de un fiche-
ro, Por ejemplo, contienen información como el nombre del autor, las fechas de
creación y modificacién, la herramienta usada para su elaboracién, nombres de
ordenadores, rutas a directorios locales, etc. En ficheros de imagenes también
pueden incluir las coordenadas GPS donde fueron tomadas, la camara emplea-
da y Ia configuracién de la misma (exposicién, apertura focal, etc.) En general,
los metadatos que almacena un fichero dependen del tipo de este.

Los metadatos constituyen una información valiosisima en el proceso de recolec-
cl6n de información para un hacker porque puede permit averiguar las versio~
nes de software que se emplean en la empresa, los nombres de usuarios, ete, lo
‘que puede permitir elaborar ataques de Ingenieria social. Por ejemplo, a través de
los metadatos se puede averiguar que la empresa utiliza una versién de Microsoft
Word potencialmente vulnerable a Follina (CVE-2022-30190), de modo que podria
enviarse un documento malicioso por correo electrénico a algunos de sus usua-
tios y esperar a que muerdan e! anzuelo,

En linea de comandos existe la herramienta exiftool, que soporta un gran abanico
de formatos de archivos. EI siguiente cuadro muestra los metadatos de un fichero
PDF, donde se puede averiguar que el fichero se ha creado con Ia herramienta
Ubreoffice Writer, version 7.4, y que ha sido convertido posteriormente a PDF.

§ exiftool secret.pdf

Exiffool Version Nunber + 10.80
File Name secret. pdf
Directory :

File Size 18 kB

+ 2022811114 10:
  2022:11:14 10:
+ 2022411:14 10:57:10+01:00

File Modification Date/Time
File Access Date/Time
File Inode Change Date/Time

File Permissions ——
File Type 1 PDF
File Type Extension pat
MIME Type +: application/pdf
PDF Version 1.6

> Listodo de nomeros magicas de icheros on Wikipeca (on inglés).
> ntpe/fensitipeciaorghwi/ist_of-fle_signatures

2. RECOPILACION DE INFORMACION 0 FoOTPRINTING &


B 2. RECOPILACION DE INFORMACION 0 FoOTPaIRTING

2. RECOPILACION DE INFORMACION 0 FoOTPRINTING &

Linearized No
Page Count. na

Language e588

creator 2 Weiter

Producer Libreoffice 7.4
Create Date 2022111214 1025721040)

1 ACTIVIDAD PROPUESTA2.9

Elige un sitio web y utiliza las herramientas MetaFinder y metagoofil para loca~
lizar archivos en él. Posteriormente, utiliza exiftool para extraer información re~
levante de sus metadatos.

tra herramienta en linea de comandos es metagoofil (https://github.com/
‘opsdisk/metagoofil), desarrollada en Python y disponible en Kali Linux para instalar
desde apt. Esta herramienta utiliza Google para buscar ficheros de un determina
do tipo que estén accesibles pibblicamente en un determinado dominio, y crear
tuna copia local si asi se indica, Metagoofil no reatiza el andlisis de metadatos, solo
realiza la busqueda y descarga de los ficheros. Para el andlisis de metadatos se
puede emplear exiftoo!

La Figura 2.22 muestra la busqueda de ficheros de tipo PDF, PNG, JPG en el domi-
nio indicado. La opcién ~e especifica una pausa de 30 segundos entre descar-
gas, y la opcién -Ilimita a § el nimero de ficheros descargados de cada tipo. La
opcién -f indica que se almacenen en un fichero de texto los enlaces usados en
las descargas.

Figura 2.22. Busqueda de documentos en formate pdt, png y jpg con metagoot

Dado que es una herramienta que automatiza las consultas y la descarga de
ficheros a través de Google, el buscador puede bloquear nuestra IP si nos iden-
tifica como un bot, por lo que para poder seguir realizando busquedas lo mejor
seréi utlizar proxychains con una configuracién de tipo round robin.

También puede utlizarse MetaFinder (https://github.com/.Josue87/MetaFinder),
que, ademas de Google, permite usar Bing y Baidu como buscadores. Por tltimo,
otra herramienta muy empleada para el análisis de metadatos es FOCA, que se
presenta en el Apartado 2.46,

w L

Es recomendable la lectura del articulo Metadata, a hacker's best friend®®, donde
se menciona un caso préctico de uso del andlisis de metadates. En el articulo se
referencia un script en bash creado por Sweepatic para este andlisis y se emplea
Splunk para un andlisis visual de todos los ficheros.

Busqueda de información textual en archivos de texto

La bUsqueda de información textual en archivos de texto es una accién muy em=
pleada por el hacker ético. La busqueda puede estar encaminada a encontrar
informaci6n relevante en un conjunto de archivos que se han obtenido en el pro-
ceso de recolecci6n, pero también se puede emplear para el andlisis 0 la audi-
torla de cédigo fuente, o para el andlisis de los archivos del sistema operative en
el proceso de movimientos laterales 0 escalada de privilegios.

En la linea de comandos de Linux esté disponible Ia utllidad grep para buscar
palabras 0 patrones de texto en ficheros. La forma general de este comando es.
la siguiente:

grep <patrén> <ficheros>

Y las opciones més utllizadas son:

ignore-case. Se ignora la sensibilidad a mayGsculas y minsculas en la
busqueda del patrén,

¢ -t,-rrecursive. Realiza la busqueda en todos los ficheros del directorio y de
todos los subdirectorios de forma recursiva,

¢ ~e patrén, --regexp=patrén, Define la expresion regular que se usaré en la
busqueda.

color. Muestra de forma coloreada las ocurrencias encontradas del patrén.
Esta opcién suele estar activada por defecto.

* Metadata: @ hackers best ind (en inglés).
  Intpe/ blog sweepatc com /metadate-hackers-best-tiend

a


B 2. RECOPILACION DE INFORMACION 0 FoOTPaIRTING

"

En el siguiente ejemplo, el comando muestra si existe el usuario alicia en el fi-
chero Jete/passwa.

3 grep alicia /ete/passud
alicia:x:1000:1000:alicia, ,,:

/none /alicia: /bin/bash

‘También pueden buscarse todos los usuarios del sistema que disponen de ac-
eso a una shell con el siguiente comando.

3 grep sh$ /ete/passud
:0:root: /root:/bin/bash
1000:1000:alicia, ,,:/home/alicia: /bin/bash

El carácter $ indica que el patrén debe encontrarse justamente al final de la Ii-
nea. También se puede utilizar el carácter A para indicar el comienzo del patrén
al principio de Ia linea.

Es posible buscar palabras o contenido relevante dentro de un fichero, por
ejemplo contrasefias, direcciones de correo electronico, numeros de DNI, ete. El
siguiente comando busca la palabra password en todos los ficheros del directo-
rio, Ignorande maysculas y con bUsqueda recursiva,

$ grep -ir "password" /directorio

Se puede aftadir la opcién --include para indicar qué tipo de fichero se desea
incluir en la busqueda, por ejemplo, ~-include=*.php.

Enel articulo Source code Audit with grep command®* se muestran ejemplos de
bUsqueda de funciones PHP vulnerables y otra información que puede ser rele-
vante, mediante el comando grep. Estos ejemplos se pueden extender facilmen-
te a otros lenguajes.

Extraccién de información textual en archivos no textuales

En el apartade anterior se estudi6 como se puede encontrar información en fi-
cheros de texto. Sin embargo, es mucho mas frecuente encontrar ficheros no
textuales en donde realizar busquedas automaticas de información es mas

® source cade aualt with grep command (an ingée)
https, /secnhackin/source-code-aucit-with-grep-command

|__ 2 SecaPnacion ae ingonmacion 9 FoorPaunring &

complejo. Un ejemplo de este tipo serian los ficheros PDF 0 los ficheros de ima-
genes que pueden tener texto en su interior.

Para el primer caso se dispone de la herramienta en linea de comandos paftotext,
Su utilidad se ilustraré con un ejemplo. Para ello se ha creado un fichero PDF que
contiene información que no deberia estar ahi, en este caso una contrasefia,
Su contenido puede verse en la Figura 2.23.

EICHERO CON INFORMACION SUPERSECRETA.

‘Una contrasefa supersegura: ,AFT6n2\&{d?50Y

Figura 2.23, Contenido del fichero secret pa.

Si se trata de buscar información textual en el contenido de cualquier fichero
POF, el resultado sera infructuoso. El comando grep “contrasefia’ *.pdf no devol-
verd ningun resultado. Por tanto, es necesario utilizar pdftotext para convertir el
fichero POF en formato textual

§ pdftotext -layout secret.pdf secret txt

Ahora, al realizar la busqueda de a palabra «contrasefia» en el fichero de texto
se obtendra un resultado positivo.

§ grep “contrasesa” *.txt
Una contrasefia supersegura: ,heT6n2”6{d?50¥

Lo mismo ocurre con archivos en formato de imagen. Estas imagenes podrian
contener información ati sin embargo, su procesamiento automatico puede ser
complejo

Para extraer la información textual que contiene una imagen se emplean técni-
cas OCR (Optical Character Recognition). Algunas de las herramientas mas dt
les para ello son las siguientes:

+ Tesseract (https://github.com/tesseract-ocr/tesseract). Desarrollada origi
  nalmente por HP, es cédigo libre desde 2005. Dispone de proyectos creados
  por la comunidad, como entornos gréficos, servicios ontine, aplicaciones mé-
  viles, etc. La herramienta esté disponible para su descarga a través de los
  repositorios de Ubuntu y Debian, y también hay una versién binaria disponible
  para Windows.

"

# nuevo OCR de las 5 imágenes siguientes

GBs coruacin oe nronmecin overruns

+ EasyOCR (https://github.com/JaidedAl/EasyOCR). Es una libreria de Python
  por lo que se puede descargar y utilizar en los scripts propios. Un aspecto muy
  destacado de esta herramienta es que soporta més de 80 lenguajes, incluidos
  chino, latin, érabe,citlico, ete. Ademés, dispone de una versién demo online

En la Figura 2.24 se muestra el resultado de haber utilizado la demo online de
EasyOCR sobre un fichero de imagen que contiene la misma informacion textual
que el fichero PDF mostrado en el ejemplo anterior.

Demo
otto

eter)

Figura 2.24, resultado del reconocimiento OCR de un fichero de imagen
on la herramienta EasyOCR. (Fuente: https//wwwjaidedal/easyc/).

Reversién de imagenes pixeladas

‘Ocultar texto sensible utiizando técnicas de pixelado de imagenes es una préctica
insegura. En su lugar, se deben usar cajas 100 % opacas que cubran por completo
el texto que se desea ocultar. Existen diversas técnicas y herramientas que per-
miten recuperar la información textual de una imagen pixelada. El articulo Reco
vering passwords from pixelized screenshots*? es una lectura muy recomendable
para profundizar en este tema y conocer investigaciones recientes.

* recovering passwords from pixeized screenshots (en inglés).
  https: wor spipmnl/2030 hire

2. RECOPILACION DE INFORMACION 0 FoOTPRINTING &

El autor de este articulo, Sipke Mellema, es el creador de Ia herramienta Depix
(https://github.com/spipm/Depix), que permite revertir el pixelado de imagenes
que se han creado con un filtro de coja lineal. En la Figura 2.25 se muestra un
ejemplo de ello.

ed aa a
HaGio from The ofher side
Se
Hello from the other side

Figura 226. Ena parte superior se muestra un texto que se ha ocultado mediante
una téchica de plielado. én ol medio, la imagen recuperada ublzando la hertamienta Depik.
(Fuente: nttps://github.com/spipm/Depit).

én 2021, Jonas Schatz publicé la herramienta DepixHMM (https://github.com/
JonasSchatz/DepixHiMM), inspirada en la anterior, pero que utiliza Modelos de
Markov Ocultos © HMM (Hidden Markov Models), cuyos resultados son mucho
més precisos. Para implementar Ia herramienta, el autor utiiz6 el paper On the
(iN)effectivenss of Mosaic and Blurring as Tools for Document Redaction, publi-
cado en 2016 por Hil Steven et al, donde se explica la creación de este tipo de
herramienta y muestra sus excelentes resultados, pero sin hacer pablico el céci
go fuente,

Por Gitimo, Unredacter (https;//github.com/bishopfox/unredacter) es una herra-
mienta desarrollada por Dan Petro para resolver un reto de reversién de una ima-
gen pixelada que fue lanzado como respuesta a la herramienta Depix

= ACTIVIDAD PROPUESTA 2.10

Busca en Internet alguna imagen con texto pixelade y trata de recuperar la in-
formacién original con alguna de las herramientas estudiadas.

Los ejemplos anteriores trabajan con texto distorsionado. En el caso de que la
Imagen distorsionada sea de otro tipo, rostros, paisajes, etc, el mecanismo mas
efectivo para tratar de averiguar cuGl es la original es mediante la busqueda in
versa de imagenes, como muestra la Figura 2.26. Es posible que antes de realizar
a busqueda inversa sea necesario tratar Ia imagen pixelada para mejorarla.

w



B 2. RECOPILACION DE INFORMACION 0 FoOTPaIRTING

wl

Figura 2.26, Bdsqued inverse de una imagen pixelada en buscador Yandex
(Fuente: https://s0mdsumedium.com/deblurring-images-for-osint-part-2-ba56doYSeb5d).

2.4.4. Informacion personal

La obtencién de información personal es de suma importancia para un hacker.
Esta información puede ser empleada posteriormente para organizar accio-
nes de ingenieria social como, por ejemplo, campanas de phishing (Aparta-
do 5112).

Por ello, serd atl tratar de identificar a los trabajadores de la empresa que se
est6 auditando, asi como el Grea 0 departamento al que estan asociados, y
‘veriguar su información personal (direcciones de correo electrénico, nimeros
de telefono, cuentas en redes sociales, ete) para tener un conocimiento amplio
del perfil personal de cada uno de ellos,

Existen multitud de herramientas especificas de reconocimiento de informacion
personal y otras tantas herramientas que integran esta funcionalidad entre una
multitud de posibles acciones de reconocimiento, Estas herramientas de prop6-
sito general se denominan frameworks, por lo que en los siguientes subaparta-
dos se tratarén solo aquellas herramientas que consideramos més especificas,

2 600 trabojadores pblics de Granada spicans en un simulacro de estata por phishing
https waw-granadahoy.com| granada|Experimento- Ayuntamiento-Granada-pishing-
‘secuestro-corraos _0_1728926428ntm|

2. RECOPILACION DE INFORMACION 0 FoOTPRINTING &

Reconocimiento de emails

El objetivo del reconocimiento de emails es averiguar todos los emails de un de-
terminado dominio. Una vez que se dispone de este listado puede comprobarse
si ese email se ha utilizado para registrarse en algin servicio o si aparece en al-
guna brecha de seguridad,

Entre este tipo de herramientas destaca Hunter (https://hunterio), un servicio
web con diferentes planes de precios. Este servicio realiza bisquedas de direc
clones de correo electrénico para un determinado dominio. €n la Figura 2.27 se
muestran unos poces resultados para el dominio iberdrola.es, pero las direccio-
nes se muestran ocultas. Para visualizar las direcciones completas es necesario
registrarse. Las cuentas registradas gratuitas tienen un limite de 25 busquedas
mensuales y la cantidad de resultados mostrados se limita a 10.

preemption aneeerliey ete

porpaeteies @ semen»

‘Sipup tc emat otesespteue se e as
sear cease

Figura 227. Busqueda de direcclones de correo electronic
para iberdrolaes en la web de Hunter.

En linea de comandos est4 disponible una herramienta similar llamada infoga
(https://github.com/mallok/infoga). Para descubrir las direcciones de emails
se emplean diferentes fuentes: buscadores, servidores de claves PGP y Shodan.
‘Ademés, permite obtener información de brechas de seguridad utilizando la API
del servicio Have | been Pwned, que se verd més adelante.

"



B 2. RECOPILACION DE INFORMACION 0 FoOTPaIRTING

Otra herramienta de cédigo abierto y con un entorno visual es IKY (I Know You)
creada por KenBro (https:/kennbroorg gitlabio/ikyweb/). Esta herramienta re-
copila todo tipo de información a partir de una direccién de email para ello es
necesario en la mayoria de los casos configurar distintas API Keys de diferentes
servicios, La herramienta permite generar informes y exportar los resultados en
formato JSON y visualizar eventos importantes en una linea de tiempo.

1 ACTIVIDAD PROPUESTA 21

Elige un dominio de Internet y compara los resultados obtenidos por Hunter.io
@ Infoga. Utiliza IKY con alguna de las direcciones de correo y observa qué in-
formacién es capaz de obtener.

Reconocimiento en redes sociales

El reconocimiento de información personal en las redes sociales puede ser atl
para identiticar relaciones personales entre los trabajadores de una empresa. Los
Usuarios de Linkedin suelen publicar su curriculum completo, por lo que no resulta
complicado hacer una busqueda de todos los empleados de una empresa. Pos-
teriormente se pueden cruzar las relaciones de amistad de estos empleados en
las distintas redes sociales y si un contacto cercano de un usuario no tiene cuen-
ta en alguna red, podriamos hacernos pasar por ese usuario en esa red para
realizar un ataque de ingenieria social, de forma similar la estata del CEO. Para
saber més sobre ingenieria social en redes se recomienda ver la chara Andii-
sis de redes sociales (ARs) y deteccién de comunidades virtuales*®, de Vicente
Aguilera y Carlos Seisdedos, en la Conferencia RootedCON'2018.

En la mayoria de las redes sociales es necesario disponer de una cuenta regis~
trada para poder consultar los datos de sus usuarios, por lo que seré itil dispo-
ner de algunas cuentas falsas para nuestras investigaciones.°

£1 primer paso es tratar de averiguar las cuentas en redes sociales que tiene re~
gistrada una persona. Para ello, la herramienta Sherlock (https://github.com/
sherlock-project/sherlock) ayuda @ automatizar el proceso, ya que se encar-
ga de comprobar si un nombre de usuario (nickname) esté registrado en una
red social. No existe garantia de que todas las cuentas con el mismo nombre de

® análisis de redes sociales (ARS) y deteccién de comunidades virtuates.
httpe/ /youtulbe/St680)_CRnM

* En los recursos para el profesorado en la web de Paraninfo puede encontrarse un documento
  sobre generacion de identiades fleas.

2. RECOPILACION DE INFORMACION 0 FoOTPRINTING &

usuario en distintas plataformas pertenezcan a la misma persona, pero lo habi-
tual es que se reutilicen. La herramienta esta disponible para instalarla desde los
repositorios de Kali Linux.

$ sudo apt install sherlock

En la Figura 2.28 se muestra un ejemplo de busqueda del nickname usuario. E|
total de coincidencias obtenido es 164,

Figura 2.28. listado de servicios en los que ol nickname «usuariow
s@ encuentra registrad, obtenide con la herramienta Sherlock

En esta seccién se estudian algunas técnicas y herramientas de OSINT dispo-
nibles para Twitter (ahora X), Mastodon e Instagram. Se ha de tener en cuenta
que, en algunos casos, estas herramientas requieren el uso de una API Key y que
el tiempo de vida en Ia que la herramienta funciona correctamente puede ser
limitado debido a cambios o imitaciones en el uso de esas API

En el caso de Twitter, la primera opcién recomendada es emplear la busque-
da avanzada disponible en la propia herramienta y que permite, entre otras co-
sas, obtener todas las publicaciones de una cuenta, las publicaciones dirigidas
una cuenta 0 las publicaciones que mencionan a una cuenta. El articulo OSINT


B 2. RECOPILACION DE INFORMACION 0 FoOTPaIRTING

‘en Twitter, 10 consejos y 10 herramientas para investigar una cuenta*' en la web
de odint.net ofrece una metodologia interesante para investigar cuentas en esta
red, asi como un listado de varias herramientas. En este caso destacan las si-
guientes

* Tinfoleak (https://tinfoleak.com). Esta herramienta ha sido desarrollada por
  Vicente Aguilera, presidente de OWASP spain, fundador de la empresa inter-
  net Security Auditors y docente en diversos mésteres y universidades. Tinfoleak
  funciona como servicio web en el que no es necesario registro, Los resultados
  de la busqueda solicitada se enviarén a la direccién de correo electrénico in-
  dicada

* Tafferugii (https://github.com/sowdust/tafferugli). Es una herramienta de
  canéliss con interfaz web enfocada a la investigacién de fend menos de propa-
  ganda y publicacién coordinada de campanas.

‘¢ Twint (https://github.com/twintproject/twint). Era una de las herramientas
mas empleadas, ya que para su uso no era necesario el uso de API Key. La-
mentablemente, el repositorio oficial fue archivado en noviembre de 2022,
pero aun asi se menciona aqui ya que pueden surgir clones (forks) que reacti-
ven el proyecto.

Mastodon es una red social de cédigo abierto muy similar a Twitter en cuanto a su
interfaz, pero utliza una arquitectura descentraizada, Tras la compra de Twitter por
parte de Elon Musk en noviembre de 2022, esta red social vio inerementado su ni-
mero de usuarios de 200 000 a més de 1 000 000 en solo unos dias, Para poder rea-
lizar operaciones de OSINT en Mastodon es necesarlo comprender cémo funciona
Ia herramienta; la guia publicada por Secluice Mastodon OSINT: A Comprehensive
Introduction"*? es una lectura recomendada si se desconoce esta red social. En
cuanto a las herramientas disponibles para automatizar esta labor, en el momen-
to de escribir estas lineas (marzo de 2023), no existen demasiadas al haberse po-
pularizado recientemente. La més popular y activa es Maste (https;//github.corn/
Can7ral0SInt4g2ney/Masto). Otro competidor de Twitter que ha nacido reciente-
mente es Threads, creado por instagram con toda la base de usuarios de esta red
social, por lo que deberd seguirse su evolucién y afadirla en nuestras investiga-
ciones OSINT,

Para Instagram se dispone de Ia herramienta Osintgram (https:|/github.com/

Datalux/Osintgram) que permite recolectar información de un usuario a través

“10SINT en Twitter, 10 consejos y 10 herramiontas para investigar una cuenta,
https, edintnet/twitter-osint/

Mastodon OSINT: A Comprehensive Introduction (en ing).
http wv. 2ecjuiee.com/mastodon-ovint-a-comprehensive-introduction|

2. RECOPILACION DE INFORMACION 0 FOOTPRIATIOG &

de linea de comands. La información se puede obtener de cuentas pUblicas o
de cuentas a las que se sigue. La Figura 2.29 muestra el error que ocurre al tratar
de recopllar información de una cuenta a la que no se esté siguiendo,

Figura 2.29. crror de Osintgram al teatar de recopila Informacion de un usuario con cuenta
privade y al que no se sigue. (Fuente: https//github.com/Datalux/Osintgram).

Reconocimiento de nimeros de teléfono

El reconocimiento de numeros de teléfono es algo més complejo, por lo que seré
dificil obtener información relevante a partir de un numero. Ademas, depende en
gran medida del pais al que pertenece el numero.

La herramienta més conocida y utlizada para esta labor es Phoneinfoga (https://
github.com/sundowndev/phoneinfoga), que permite obtener información del
tipo de linea, del propietario y del proveedor del servicio, entre otros datos. Ade-
mAs de usar la herramienta, resulta interesante leer el articulo asociado publica
do en Medium donde el autor explica el proceso de creación de la herramienta y
los diferentes problemas con los que se ha encontrado para recolectar la infor-
maci6n, La Figura 2.30 extraida de esta publicacién muestra de forma esquemé-
tica el proceso de escaneo que sigue Phoneinfoga.


B 2. RECOPILACION DE INFORMACION 0 FoOTPaIRTING

Figura 2.20, Procese de footprinting seguido por Phoneinfoga,
(Fuente: hitps://sundowndev.medium.com/phone-number-scanning-
‘osint-recon-too!-6ads/0cac27b).

2.4.5. Basqueda de informacion en filtraciones (leaks)

Una fuga de información, fltracion o leak es la publicaci6n de datos confiden-
ciales de una determinada empresa u organizacién. Esta fuga de informacion
puede ocurrir por motivos malintencionados a través de un insider, clberdelin-
‘cuente u otro actor, o bien, por errores humanos en el tratamiento de esa infor
maci6n.

La web Wikileaks es uno de los sitios mas reconocides donde se hacen ptiblicos
miles de documentos que comprometen las actividades dudosas o ilegales de
Estados, organizaciones gubernamentales, empresas, etc. Fue fundada en 2006
por Julian Assange y desde entonces se realizan publicaciones que incomodan
 multitud de Gobiernos. En 2010, Wikileaks publicé informacion contidencial del
ejército de los Estados Unidos (cerca de 750 000 documentos) que obtuvo a tra-
vvés de Chelsea Manning, Estos documentos incluian información de las guerras
de Irak y Afganistén, y entre ellos un video que mostraba el asesinato de civiles
en un bombardeo en Bagdag, Esta publicacién le costé a Assange una orden de
captura y su arresto final en la embajada de Ecuador en Londres.

No todos los sitios web donde se publican fugas de información tienen un caréc~
ter hacktivista como Wikileaks. La mayoria de ellos consisten en publicaciones de
documentos confidenciales o personales que realizan los clberdelincuentes tras
solicitar un rescate y recibir la negativa de la victima de pagarlo. En esos casos,

we

2. RECOPILACION DE INFORMACION 0 FoOTPRINTING &

los delincuentes suelen cumplir sus amenazas y permiten que todo el mundo
tenga acceso a esa informaci6n.

En los siguientes apartados se veré una clasificacién de los servicios y herra~
mientas més comunes para realizar busquedas de información en leaks.

Servicios para comprabar filtraciones

El sitio web Have | been pwned? (https://haveibeenpwned.com/) es el lugar de
referencia para comprobar si nuestros datos personales aparecen en una bre-
cha de información. El sitio rastrea las brechas de seguridad que se han pro-
ducido y cuyos dates se han publicado para comprobar si en ellas aparece
nuestro correo electrénico © nuestro teléfono. También permite comprobar si
una determinada contrasefa ha sido comprometida en algin leak y descargar
Ia lista completa de contrasehas comprometidas (17 68). La Figura 231 muestra
un ejemplo de contrasenia que aparece en 761 leaks.

‘También permite configurar notificaciones para ser avisados en el correo propio
sien algun momento se viese comprometido en futuras fugas. Ademas, ofrece un
servicio de API gratuite con un limite de una peticién por 1500 ms, algo més que
interesante para utilizarlo en nuestros scripts o en herramientas de automatiza-
cién de terceros que lo requieren

Figura 2.1. Informacion del sitio web Have | been pwned?
sobre una contrasena comprometida 761 veces.

Otros dos sitios donde se pueden comprobar leaks son:

# Dehashed (https://dehashed.com/). és un servicio similar al anterior, pero

ofrece mas campos de busqueda como nombres, nombres de usuario, direc~

ciones IP. Por contra, para poder usarlo es necesario estar registrado, ademas
de que ciertos servicios son de pago.

a /4

# Recuperación de Información y Footprinting

#### 2.3.1. Información Whois

Según datos de Verisign, a finales del tercer trimestre de 2021 existían 364,6 millones de nombres de dominio. El registrante (registrant) de un dominio debe proporcionar información básica para poder hacerse con él. El protocolo whois permite consultar y almacenar esta información.

### Herramientas útiles para consultar Whois:

- https://whois.net/
- https://who.is/
- https://lookup.icann.org/
- https://godaddy.com/whois

### 2.4. Reconocimiento en Redes Sociales

El reconocimiento de información personal en las redes sociales puede ser útil para identificar relaciones personales entre los empleados de una empresa.

### Herramientas recomendadas:

- Sherlock (https://github.com/sherlock-project/sherlock): Herramienta que permite investigar si un nombre de usuario está registrado en diversas plataformas sociales.

### 2.5. Laboratorio de Prácticas

El primer laboratorio de prácticas de esta unidad está dedicado a configurar nuestro sistema para poder realizar conexiones anónimas a través de la red Tor.

### Configuración de Proxychains

Para configurar los servicios de proxychains en línea de comandos:

```bash
$ sudo apt install tor proxychains
$ sudo systemctl enable tor.service
$ sudo service tor start
```

### 2.6. Frameworks para OSINT

Existen varios frameworks que facilitan el proceso de OSINT desde una sola plataforma:

- **OSR Framework**: Herramienta para búsquedas de información en correos electrónicos, números de teléfono, redes sociales, etc.
- **theHarvester**: Utilizado para obtener información de emails, nombres de usuario y subdominios de un dominio.

B 2. RECOPILACION DE INFORMACION 0 FoOTPaIRTING 2. RECOPILACION DE INFORMACION 0 FoOTPRINTING &

2.5.2. Reconocimiento en fuentes abiertas con recon-ng modules Interfaces with installed modules
options Manages the current context options
ab Starts a Python Debugger session (dev only)

Con el comando recon-ng se carga la aplicacién mostrando el prompt [recon

seript Racoria and exectten comand ecripts
ng]| default], siendo default el espacio de trabajo (workspace) predeterminado. ae eee oe te ceeenae

Mas adelante se expica cémo crear espacios de trabajo para cada proyecto de fae Sey
reconocimiento que deba realizarse. En la Figura 2.37 se observa el mensaje No ee Cite eet
modules enabled/installed. Se pueden instalar nuevos médulos desde el Market Bees Spocia ontpat to a Eile

place, como se explica mas adelante. wockapeces Hanagen workspaces

A su vez, se puede obtener ayuda de cualquiera de los comandos disponibles
con <comando> help.

[xecon-ng}[default] > workspaces help
Manages workspaces:

Usage: workspaces <create| ist |1oad| renove> [

Los comandos permiten autocompletar con la tecla Tab, lo que agiliza enorme-
mente el trabajo en el entorno.

El comando shell o el cardcter ! permiten ejecutar comandos de la shell. A conti-
nuaci6n se muestran dos ejemplos de uso.

[zecon-ng](default} > shell ip a
[xecon-ng} [default] >

s -la

Figura 2.27. Prompt de recon-ng aliniclar por primera vez ,
a re 9 pore Gestion de espacios de trabajo

Los espacios de trabajo permiten organizar los proyectos de reconocimiento de

modo que la información recolectada esté agrupada en un mismo lugar. Asi,

faclita poder retomar el proyecto en distintos momentos y hacer el andlisis pos-

Para obtener ayuda de los comandos disponibles se puede ejecutar help.

(een AE) lp terior una vez se haya finalizado
commands (type {hetp|?] <topic>) él comando worskspaces se encarga de gestionar los espacios de trabajo en
recon-ng, Las opciones disponibies son:
back Brits the oarrent context.
Peters RRS 0 cs) o casei + create <proyecto>. Crea un nuevo espacio de trabajo con el nombre proyecto.
@ Interfaces vith the workspaoa'a database . __ # list Lista los espacios de trabajo existentes.
exit Brite the framework

+ load <proyecto>. Carga el espacio de trabajo proyecto en el entorno
  help Displays this menu proy 9 Pp io proy.
  fetes Gres oma fen Cep + remove <proyecto>. elimina el espacio de trabajo proyecto del entorno.
  =D faye ene pay ae ec b i | Acontinuacién se muestra una prueba de ejecucién de estos comandos, crean~
  pose ketplac Susans Cae Ga Cao Coase 3 5 do dos nuevos espacios de trabajo, proyectol y proyecto2, listando, cargando y



B 2. RECOPILACION DE INFORMACION 0 FoOTPaIRTING >» 2. RECOPILACION DE INFORMACION 0 FoOTPRINTING &

eliminando estos workspaces. Obsérvese como cambia el prompt del workspace El marketplace de recon-ng

cargade en el entorno en cada momento.
recon-ng viene sin médulos instalados por defecto, Los médulos se instalan

desde el marketplace, para lo que se dispone del comando marketplace con
diferentes opciones:

[recon-ng} [default] > workspaces create proyectol
[zecon-ng][preyectol] > workspaces create proyecto?
[xecon-ng][proyecto2] > workspaces List

Usage: marketplace <info|install|refresh|renove|search> [.

La opcién search permite buscar entre los médulos disponibles en el marketpla-

| Workspaces | Modified |

+ ce; si no se indica ninguna cadena de busqueda se mostraré Ia lista completa

| degaute | 2021-11-17 05:20:07 | (a siguiente tabla muestra un resumen de la salida).

| proyectet | 2021-11-17 05:55:57 |

| SSRs jam Coen | [reconcng]{defasle] > marketplace search

i rch [vecsico | status | opdated To ||

‘tro comando interesante es snapshots, que permite guardar copias de segu- | secon/eopanies-contacts/bing linkedin cache | 2.0 | not snetalted | 2019-06-26 | | + |
ridad o instanténeas del estado actual del espacio de trabajo que se pueden | recon/companies-contacte/censys email adiress | 2.0 | not Snstalled | 2021-88-11 | + | + |
recuperar en cualquier momento. | recon/companies-contacts/pen [1.1 | oot dnstatted | 2018-10-15 | ||

= tar dependencies. See into for detaite.

Usage: snapshots <list|load|renove|take> (.
= Reguizes keys. See info for details.

Con la opcién take se guarda el estado actual que puede recuperarse en cual-

Los médulos marcados con * en Ia columna D tienen dependencias de paquetes
quier momento con Ia opcién load. La opcién list muestra todas las copias guar-

‘que deben ser resueltas para poder ser usados correctamente. Asimismo, los médu-

dadas de este espacio de trabajo.
a i los marcados en la columna K indican que requieren el uso de una clave o API Key.
[recon-ng}{default} > snapshots take Es posible obtener una busqueda més concisa indicando una cadena; por ejem=
[+] Snapshot created: snapshot_20211202085328.db plo, la siguiente busqueda muestra los médulos relacionados con Google.
También es posible interaccionar directamente con los datos del espacio de tra~ Fn Sy SEES
bajo almacenados en Ia base de datos con el comando db. [+] Searching nodule index for “google’ ==.
Usage: db <delete| insert |notes |query|schema> [ i
1
La opcién schema muestra las tablas y los atributos de estas. También es po- +

sible hacer consultas con query, o insertar y eliminar datos con insert y delete,
Esto ultimo seré necesario si se desea eliminar entradas duplicadas.

Gependencies. S00 info for details.
= Regsizes keys. See info for detaila.

tra opcién es utilizar una herramienta externa, como sqlitebrowser. Existe un
fichero data.db dentro del directorio de cada espacio de trabajo. La ruta donde
se almacenan es:

La opcién info permite obtener mas información de un médulo determinado;
para ello hay que indicar el path de! médulo que se desea consultar.

recon-ng|[default) > marketplace info recon/donains-hosts/google

‘/none/kal i/.recon-ng/workspaces/<proyecto>/data.db

i i

B 2. RECOPILACION DE INFORMACION 0 FoOTPaIRTING

A continuacién se instalaréin los médulos google_site_web y hackertarget con
la opcién install. En el comando de instalacién se puede obviar la ruta completa
del médulo si la cadena de busqueda empleada identifica de forma Gnica al
médulo que se desea instalar.

google site web

Fecon-ng}[default] > marketplace install recon/donains-host
[recon-ng}{default} > marketplace install hackertarget

Se puede examinar [a lista de médulos disponibles ¢ instalar aquellos que se
consideren interesantes para la labor de reconocimiento.

1 ACTIVIDAD PROPUESTA 2.15

Examina la lista de médulos disponibles en el marketplace de recen-ng
instala alguno de ellos, Algunos médulos recomendados son: whois _pocs,
threadminer, recon/companies~domains/pen y recon/domains-hosts/bing_
domain_web,

Gestion de los médulos

Los médulos instalados en recon-ng se gestionan con el comando modules.
Este comando dispone de las opciones load, reload y search, para cargar, re-
cargar y buscar médulos instalados, respectivamente.

Usage: modules <load|reload|search> [.

La opcién search permite buscar un médulo instalado; de no indicar una cadena
de busqueda mostraré todos.

[econ-ng}{default} > nodules search

2. RECOPILACION DE INFORMACION 0 FoOTPRINTING &

Para obtener información completa del médulo cargado esté el comando info.

(econ-ng}(default}{hackertarget] > info

Se distinguen diferentes secciones de informaci6n: el autor del médulo, la des-
cripcién y una seccién de opciones que enumera la lista de opciones de con-
figuracién que tiene el médulo. Aquellas opciones cuya columna Required sea
yes deben ser configuradas con un valor. En la columna Current Value aparece
el valor cargado por defecto o vacia si no existe ningin valor.

Para gestionar las opciones de un médulo se dispone del comando options.

Usage: options <list|set|unset> [..

La opcién list permite consultar todas las opciones del médulo cargado, que
coincidiré con lo mostrado por info.

[zecon-ng]|default|[hackertarget] > options list

Mane Current Value Required bescription

SOURCE default yes source of input (see ‘info’ for details)

Las opciones set y unset permiten establecer 0 borrar el valor de una opcién.
Para el médulo hackertarget que se esté revisando debe establecerse la op-
ci6n SOURCE a la URL sobre la que el médulo realizaré la consulta. El siguiente
‘cuadro de cédigo muestra la configuracién del médulo para enumerar el domi-
nio leszaidinvergeles.org.

[recon-ng} [default |{hackertarget] > options set SOURCE ieszaidinvergeles.org
SOURCE => ieszaidinvergeles.org

La opcién load activa el médulo seleccionade para poder prepararlo para su
ejecucién, Se puede indicar la ruta completa o el nombre del médulo si lo identi-
fica univocamente. En el siguiente cuadro se puede observar que el médulo car
gado se muestra en el prompt a continuacién del nombre del workspace.

recon-ng](default] > modules load recon/donains-hosts/google site web
[zecon-ng]| default }(google_site web] > modules load hackertarget
[econ-ng} [default }{hackertarget | >

El comando options list se puede volver a utilizar para comprobar cémo ha
cambiado el valor de SOURCE.

[zecon-ng] default |(hackertarget] > options list

Name Current Value Required Description

SOURCE ieszaidinvergel

source of input (see ‘info’ for details)

vo

™



B 2. RECOPILACION DE INFORMACION 0 FoOTPaIRTING >» 2. RECOPILACION DE INFORMACION 0 FoOTPRINTING &

También se dispone del comando input para mostrar todos los valores de en- [recon-ng) [prueba] > marketplace inetall shoden
trada del médulo, 1) PE pons, SH Ra oe, ET

(zecon-ng)(default}(hackertarget] > input

El comand keys permite gestionar las claves para los médulos que lo requieran,

Una vez configurado el médulo ya solo queda ejecutarlo, para lo que se utiliza el

‘comando run, Usage: keys <add|list |remove> [...]

[zecon-ng] [default |(hackertarget] > run Se puede ver el istado de claves almacenadas con la opcién list.

[zecon-ng][default] > keys list

El médulo ha obtenido tres nuevos hosts. Realizando la prueba con otro médulo,

bing_domain_web, no se obtiene ningun resultado nuevo.
Con la opcién add se puede afiadir el valor a la clave deseada. A continuaci6n

se muestra cémo afiadir la API Key de Shodan.

(Ss) SED Ee
{emcee (3 omens] elon OURO Sees ed atreryetes ory

[xecon-ng}[defaui¢] [bing domain web] > ran

[recon-ng}{default] > keys add shodan_api <insertar aqui 1a API Key>

Probando otro médulo, recon/domains-hosts/brute_hosts, al concluir la bas~ Ya se podria cargar un médulo de Shodan, configura sus opciones y probar su
queda se indica que ha obtenido un nuevo host funcionamiento. El médulo shodan._ip busca en la base de datos de Shodan

información relacionada con las direcciones IP almacenadas en el espacio de
trabajo y actualiza la base de datos de puertos.

Gestion de API Keys

Algunos médulos requieren de una clave para poder ser ejecutados y hacer
consultas a Ia API de la aplicacién. A veces basta con registrarse en la web del Nene Current Value Required description
servicio correspondiente para poder tener nuestra AP! Key (normalmente con

restricciones) y en otras ocasiones es necesario disponer de una cuenta de ur 1
pago para tener acceso a todas las acciones de la AP! sin restricciones.

[zecon-ng]|default}[shodan_ip] > options list

Limit number of api requests per input
unlimited)
SOURCE default yes source of input (see 'info’ for details)

source (0

Para demostrar el funcionamiento de médulos que requieren una API Key se uti
lizarén varios médulos para realizar consultas con Shodan, para lo cual es pre-
ciso estar registrados. Es posible obtener a lista de médulos disponibles en el
marketplace con el comando aprendido en la seccién anterior.

[econ-ng} [prueba] (shodan_ip] > input

Module Inputs

[econ-ng}[default} > marketplace search shodan | 0.28.211.131 |
| e8.12.s4.231 |
| 217.160.0.66 |

En la información mostrada para los distintos médulos (marketplace info <mé-
dulo>) se observa el contenido de la seccién required_keys, que es ‘shodan_
api’. Esto indica que hay que tener configurada esa clave para poder usar el
médulo. Se instalardn todos los médulos relacionados con Shodan y a continua
cién se afadird la clave para poder usarios. En la instalacién ya se avisa de que
no se ha establecido la clave ‘shodan_api.

[zecon-ng}(prueba]{shodan_ip] > run

[zecon-ng] [prueba] (shodan_ip] > show porte
[+] Mo data returned.

We "a



B 2. RECOPILACION DE INFORMACION 0 FoOTPaIRTING

Como se observa en el cuadro de cédigo anterior, con el comando input se puede
consultar Ia lista de datos de entrada que usara el médulo. En este caso, se van a
consular las IP obtenidas por el médulo hackertarget y almacenadas en la base de
datos, Para el ejemplo conereto no se ha encontrado informacion de puertos abier-
tos con el médulo de shedan_ip. Posiblemente se requiera de una API Key de pago.

Gestion de lo información obtenida por los médulos

La informaci6n obtenida por los diferentes médulos se puede consultar con el
comando show.

[recon-ng)[defaui¢)[backertarget] > show

La lista de equipos se puede consultar con la opcién hosts,

[recon-ng) default) [backertarget] > show hort

[epi |coantry|Ietitee [longitu acts | mtnle |

11 [intomatice esaiioverple.or| 8.20.21. | | | seers |
| 2 | rverieassionerslerorg [00.12.5620 | || sacar |
13 | wmvdanaidimerpetesorg | [217160.0.6 | || tasers |
14 | ftpsiersidimrerpetesorg — [2171600.64 | || arta tare |

Otro comand interesante es dashboard, que devuelve un resumen de la activi-
dad realizada en el workspace.

[zecon-ng][ default] > dashboard

i Activity Sumary \

Hl Module Runs |

econ/companies-multi/shodan_org
‘eecon/domains-contacts/whois_pocs

econ/domains-hosts/brute hosts

|
|
| recon/donains-hosts/bing domain web
|
|  recon/donains-hosts /hackertarget

2. RECOPILACION DE INFORMACION 0 FoOTPRINTING &

| recon/donains-hosts /shodan_hostnane 1 i
| recon/hosts-ports/shodan_ip 1 i
| recon/locations-pushpins/shodan 1 I

| Results Summary \

i category | quantity |

Domains
Companies
Netblocks
Locations
Vulnerabilities
Ports

contacts
credentials
Leaks
Pushpins
Profiles

|
|
|
|
|
|
| Hosts
|
|
|
|
|
|

Repositories

Recon-web

El comand recon-web inicia un servicio web para poder acceder a todos los.
datos almacenados por el programa desde un navegador.

Figura 2.28. jecucién del comando recon-web que inicia
‘un servidor web local en el puerto 5000.

Tras esto, se procede a abrir el navegador y consultar la URL http://locathost:5000.
Es posible seleccionar e! workspace en la parte superior derecha y apareceré un
resumen similar al comando dashboard.


B 2. RECOPILACION OE INFORMACION {1

ACTIVIDADES FINALES

DE COMPROBACION
21, gQué nombre recibe el proceso empleado para obtener inteligencia? qué
disciplinas son més relevantes desde el punto de vista del hacking ético?

22. Clasifica a qué tipo de web (surface, deep 0 dark) se corresponden lo
    siguientes ejemplos:

a) La platatorma de ensenanza de tu centro educative donde el
profesorado sube materiales, comparte actividades y el alumnado
participa en cada uno de los médulos en los que se encuentra
matriculado,

») La pagina web de tu centro educative donde se ofrece información de
su historia, la oferta educativa, noticias, eteétera

c) La pagina donde se ofrece malware as a service por un grupo
de ciberdelincuentes y que solo esta accesible usando un cliente
especitico

2.3. Qué opcién ofrece mayor anonimato, VPN 0 Tor?
2.4. ¢CuGl es la utilidad del protocolo DNS?

2.8. Define los diferentes términos involucrados en el registro de un nombre de
dominio:

+ Registrante (registrant),
  '* Registrador (registrar)
  '* operadores de registro (registry operators).

26. gAdénde te debes dirigit para obtener información de un dominio .es?

2.7. ¢Cémo se llama el protocolo experimental que se utiliza para obtener
subdominios mediante certificados digitales?

2.8. <Qué tipos de transferencias de zona existen?
2.9. Qué información se puede obtener con DNS Cache Snooping?

2.10. gQué son los dorks?

ne

ACTIVIDADES FINALES

‘ DE APLICACION

an.

212.

213,

‘Antes de comenzar la recogida de información es necesario valorar el es-
tado actual de tu privacidad, tanto en los equipos informaticos que usas
como en Ia información personal que puede encontrarse publicamente.
Comprueba cual es el estado de privacidad y anonimato de tus equipos y
tuinformacién personal, y razona sobre qué medidas deberias tomar para
mejorar este aspecto.*®

‘A menudo usamos diferentes dispositivos para conectarnos a Internet,
equipos portatiles o de sobremesa, tablets, teléfonos méviles. Para desem-
pefiar nuestro trabajo con garantias es importante independizar los dispo-
sitivos de trabajo de los personales siempre que sea posible. En cualquier
caso, el dispositive que usemos para realizar nuestro trabajo deber4 tener
las herramientas y configuracion apropiada para poder hacerlo de mane-
ra anónima y segura. £1 punto de partida inicial de esta actividad deberia
ser el andlisis realizado en la actividad anterior, ya que puedes explicar las
lternativas que usarés frente a aquellas herramientas o aplicaciones que
descubriste que no eran del todo anénimas y seguras.

En esta actividad deberés configurar tu ordenador personal y tu dispositi~
vo mévil con las herramientas que creas convenientes para desemperiar
tu trabajo de forma anónima y segura. Para ello, se recomienda consultar
las paginas de los proyectos Prism-Break y Privacy Tools y las distribucio-
nes orientadas al anonimato Tails o Whonix.*®

Genera perfiles en redes sociales con identidades falsas que puedas em-
plear en ciberinvestigaciones. investiga si hay herramientas que te puedan
ayudar en esta labor, ya que un buen perfil falso deberia tener algin tipo
de actividad para que pueda parecer una cuenta real#®

“© En la web de Paraninfo encontrarés una guia donde se explica céme analizar
‘ysecurizar el entomo de trabajo como paso previo para realizar ciberinvestigaciones.

"En la web de Paraninfo encontrarés una guia sobre generacin de identidades faleas
para ciberinvestigaciones.

0

|__ 2 RECoPacion a nFoRMON &


B 2. RECOPILACION OE INFORMACION {1

rf

ACTIVIDADES FINALES

2114, Elige una empresa de tamafio mediano-grande y pon en practica lo
aprendido sobre el reconocimiento DNS. Elabora un documento que con-
tenga un resumen con los siguientes apartados:

+ Descripcién del objetivo.
+ Obtencién de dominios TLo.

+ Obtencién de subdominios.

‘* Obtencién de servidores de nombres (NS) y servidores de correo (Mx),

+ Testeo de vulnerabilidades (transferencia de zona y DNS Cache Snooping)
+ Obtencién de rangos de direcciones IP y nombres de redes (netnames)

‘¢ Conclusiones.

2.6. Continuando con Ia actividad anterior, pon en practica lo aprendido en
esta unidad sobre técnicas y herramientas para recopilar informacion y
elabora un informe de footprinting’? que contenga los siguientes apar-
tados:

1. Elecci6n del objetivo y justificaci6n.

2. Reconocimiento DNS: resumen organizado de la información obtenida
   en la tarea anterior y la nueva información que puedas obtener a tra-
   vés de las herramientas vistas en la unidad

3, Reconocimiento web.
Andlisis de archivos.
Hacking con buscadores.

Informacién personal (empleados, emails, leaks, eteétera),

Some

Conelusiones.

“En la web de Paraninfo encontrarés una plantila de ejemplo para el informe de footprinting.

ACTIVIDADES FINALES

‘ DE AMPLIACION

216. El proyecto Onion-Pi*® utiliza una Raspberry Pi para construir un proxy Tor
     domeéstico. investiga cémo anonimizar las conexiones de todo un domici-
     lio configurando un punto de acceso Wi-Fi para que enrute todo el trafico
     de salida hacia la red Tor.

2.17. investiga alguna de las vulnerabilidades o debilidades de Tor. Localiza los,
papers o investigaciones originales y escribe una pequefia resefia de al-
guno de ellos

2.18. Revisa alguno de los articulos de The Hacker Way‘? sobre Tor para explorar
todas las posibilidades que ofrece en nuestras investigaciones.

218. Emplea recon-ng para recopilar información de un dominio de internet de
     tueleccién.

219. Explora los laboratorios gratuites de TryHackMe®® y realiza alguno que esté
     relacionado con los contenidos de la unidad.

+8 proyecto Onion-F (en inglés). pe [leamodatu.com/onion-pi/overview

+ ariculos sobre la red Tor en The Hacker Way. ps thehackerway.com|tag/nacking-tor]

En la web de Paraninfo puades descargar un documento con un itado de laboratorio en
TryHlockie donde puedes repasar los contenides estudiados en esta unidad,

"8

|__ 2 RECoPacion a nFoRMON &
